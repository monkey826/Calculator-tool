var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},wijmo;(function(e){(function(e){function r(e,t){var n;if(Object.create)try{n=Object.create(e)}catch(r){n=null}if(!n){function i(){}i.prototype=e,n=new i}return t&&$.extend(n,t),n}function i(e){try{return JSON.parse(e)}catch(t){return e}}var t=function(t){function n(n,r){t.call(this),this.url=n,this.options=r,this.isRemote=!0,n||e.errors.noUrl(),this._construct(r)}return __extends(n,t),n.prototype._construct=function(e){e=$.extend(!0,{ajax:{data:{},timeout:6e4},serverSettings:{skip:"$skip",take:"$top",results:"results",totalItemCount:"totalItemCount"}},e),t.prototype._construct.call(this,e)},n.prototype._remoteRefresh=function(){var t=this,n=$.Deferred(),s=this.options,o=r(this.options.ajax),u=s.serverSettings;o.data=o.data&&r(o.data)||{},u&&!this.options.localPaging&&(u.skip&&this._shape._skip>0&&e.util.setProperty(o.data,u.skip,this._shape._skip),u.take&&this._shape._take>0&&e.util.setProperty(o.data,u.take,this._shape._take)),this.options.onRequest&&(o=this.options.onRequest(o,this._shape.toObj())||o);var a=$.ajax(this.url,$.extend({},o,{error:function(r,i,s){if(f.canceled)return;e.util.logError("Could not load "+t.url),s&&e.util.logError(s),n.rejectWith(t,arguments)},success:function(r){if(f.canceled)return;var o;e.util.isString(r)&&(r=i(r)),t.options.onResponse?o=t.options.onResponse(r):$.isArray(r)?o={results:r}:u&&(o={results:e.util.getProperty(r,u.results),totalItemCount:e.util.getProperty(r,u.totalItemCount)},e.util.isString(o.totalItemCount)&&(o.totalItemCount=parseInt(o.totalItemCount,10))),o.results||e.errors.ajax_arrayResponseExpected(r),e.util.convertDateProperties(o.results),t.sourceArray=o.results,!s.localPaging&&e.util.isNumeric(o.totalItemCount)&&t._totalItemCount(o.totalItemCount),t._localRefresh().then(n.resolve)},complete:function(){t._currentRequest=null}})),f=this._currentRequest={xhr:a,canceled:!1};return n.promise()},n.prototype.cancelRefresh=function(){this._currentRequest&&(this._currentRequest.canceled=!0,this.options.ajax.dataType!=="jsonp"&&this._currentRequest.xhr.abort(),this._currentRequest=null)},n.prototype.clone=function(){return new n(this.url,$.extend(!0,{},this.options))},n}(e.RemoteDataView);e.AjaxDataView=t;var n=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype._construct=function(r){r=$.extend(!0,{ajax:{jsonp:"$callback",data:{$format:"json",$inlinecount:"allpages"}},onRequest:function(e,t){return typeof t.filter=="object"&&t.filter!=null&&(e.data.$filter=n._filterExpr(t.filter)),$.isArray(t.sort)&&(e.data.$orderby=$.map(t.sort,function(e){return e.property+(e.asc?"":" desc")}).join(", ")),e},onResponse:function(t){var n;if(t.d){t=t.d;if($.isArray(t))n={results:t};else{n={results:t.results};var i=parseInt(t.__count,10);e.util.isNumeric(i)&&!r.localPaging&&(n.totalItemCount=i)}}else if(t.value){n={results:t.value};var i=parseInt(t["odata.count"],10);e.util.isNumeric(i)&&!r.localPaging&&(n.totalItemCount=i)}return n}},r),t.prototype._construct.call(this,r)},n.prototype.clone=function(){return new n(this.url,$.extend(!0,{},this.options))},n._filterExpr=function(e){if(!e)return"";var t=[];return $.each(e,function(e,r){t.push(n._conditionExpr(e,r))}),t.join(" and ")},n._conditionExpr=function(t,r){if($.isArray(r)){var i=[];return e.util.each(r,function(r,s){if(e.util.isString(s))return;i.push(n._conditionExpr(t,s))}),i.join(r[0])}var s=r.value,o="("+t+", '"+s+"')",u=r.op.name.toLowerCase(),a=!0;s instanceof Date&&(a=!1,s=this._convertDate(s));switch(u){case"contains":return"indexof"+o+" ge 0";case"notcontains":return"indexof"+o+" lt 0";case"beginswith":return"startswith"+o+" eq true";case"endswith":return"endswith"+o+" eq true";default:return u=n._filterOperators[u]||u,t+" "+u+" "+(isNaN(s)&&a?"'"+s+"'":s)}},n._convertDate=function(e,t){var n=function(e){return e<10?"0"+e:e+""};if(e){var r=t?e.getUTCFullYear()+"-"+n(e.getUTCMonth()+1)+"-"+n(e.getUTCDate())+"T"+n(e.getUTCHours())+":"+n(e.getUTCMinutes())+":"+n(e.getUTCSeconds())+"Z":e.getFullYear()+"-"+n(e.getMonth()+1)+"-"+n(e.getDate())+"T"+n(e.getHours())+":"+n(e.getMinutes())+":"+n(e.getSeconds());return"datetime'"+r+"'"}return""},n._filterOperators={"<":"lt","<=":"le",">":"gt",">=":"ge","==":"eq","!=":"ne",less:"lt",lessorequal:"le",greater:"gt",greaterorequal:"ge",equals:"eq",notequal:"ne",contains:!0,notcontains:!0,beginswith:!0,endswith:!0},n}(t);e.ODataView=n,e.errors._register({ajax_arrayResponseExpected:"Could not parse the server response. Specify onResponse option to parse the server response. \nResponse: {0}"})})(e.data||(e.data={}));var t=e.data})(wijmo||(wijmo={}));