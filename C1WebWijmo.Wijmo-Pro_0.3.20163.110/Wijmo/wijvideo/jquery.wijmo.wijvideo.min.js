var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},wijmo;(function(e){(function(t){var n=jQuery,r={widgetName:"wijvideo",wijvideoClass:"wijmo-wijvideo",wijvideoWrapperClass:"wijmo-wijvideo-wrapper",wijvideoControlsClass:"wijmo-wijvideo-controls",wijvideoPlayClass:"wijmo-wijvideo-play",wijvideoIndexClass:"wijmo-wijvideo-index",wijvideoIndexSliderClass:"wijmo-wijvideo-index-slider",wijvideoTimerClass:"wijmo-wijvideo-timer",wijvideoVolumeClass:"wijmo-wijvideo-volume",wijvideoVolumeContainerClass:"wijmo-wijvideo-volume-container",wijvideoVolumeSliderClass:"wijmo-wijvideo-volumeslider",wijvideoFullScreenClass:"wijmo-wijvideo-fullscreen",wijvideoContainerFullScreenClass:"wijmo-wijvideo-container-fullscreen"},i=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._createVideoDom=function(){var e=this.options.wijCSS,t=" ",i=[r.wijvideoClass,e.wijvideo,e.content,e.widget].join(t),s=[r.wijvideoWrapperClass,e.wijvideoWrapper].join(t),o=[r.wijvideoControlsClass,e.wijvideoControls,e.header,e.helperClearFix,e.helperReset].join(t),u=[r.wijvideoPlayClass,e.wijvideoPlay,e.stateDefault,e.cornerAll].join(t),a=[e.icon,e.iconPlay].join(t),f=[r.wijvideoIndexClass,e.wijvideoIndex].join(t),l=[r.wijvideoIndexSliderClass,e.wijvideoIndexSlider].join(t),c=[r.wijvideoTimerClass,e.wijvideoTimer,e.stateDefault].join(t),h=[r.wijvideoVolumeClass,e.wijvideoVolume,e.stateDefault,e.cornerAll].join(t),p=[r.wijvideoVolumeContainerClass,e.wijvideoVolumeContainer].join(t),d=[r.wijvideoVolumeSliderClass,e.wijvideoVolumeSlider,e.stateDefault,e.cornerTop].join(t),v=[e.icon,e.iconVolumeOn].join(t),m=[r.wijvideoFullScreenClass,e.wijvideoFullScreen,e.stateDefault,e.cornerAll].join(t),g=[e.icon,e.iconArrow4Diag].join(t),y,b;y=n("<div>").addClass(i),b=n("<div>").addClass(s).append(n("<ul>").addClass(o).append(n("<li>").addClass(u).append(n("<span>").addClass(a))).append(n("<li>").addClass(f).append(n("<div>").addClass(l))).append(n("<li>00:00</li>").addClass(c)).append(n("<li>").addClass(h).append(n("<div>").addClass(p).append(n("<div>").addClass(d))).append(n("<span>").addClass(v))).append(n("<li>").addClass(m).append(n("<span>").addClass(g)))),this.$video.wrap(y).after(b)},t.prototype._initialSlideControl=function(){var e=this,t,n,i=e.options.wijCSS,s=e.options;e.$seekSlider=e.$vidParent.find("."+r.wijvideoIndexSliderClass),n=window.setInterval(function(){e._getVideoAttribute("readyState")&&(window.clearInterval(n),e.$vidParent.width(e.$video.outerWidth()).height(e.$video.outerHeight()),e.$wijvideoControl.show(),t=e.$vidParent.find("."+r.wijvideoTimerClass).position().left,e.$seekSlider.width(t-e.$seekSlider.position().left-15),e.$seekSlider.slider({value:0,step:.01,max:e._getVideoAttribute("duration"),range:"min",stop:function(t,n){e._seeking=!1,e._setVideoAttribute("currentTime",n.value)},slide:function(){e._seeking=!0}}).slider("widget").addClass(s.wijCSS.stateDefault),e._updateTime(),e.$volumeSlider=e.$vidParent.find("."+r.wijvideoVolumeSliderClass),e.$volumeSlider.slider({min:0,max:1,value:e._getVideoAttribute("volume"),step:.1,orientation:"vertical",range:"min",slide:function(t,n){e._setVideoAttribute("volume",n.value),n.value===0?(e._volumnOn=!1,e.$volumeBtn.find("span").removeClass(i.iconVolumeOn).addClass(i.iconVolumeOff)):(e._volumnOn=!0,e.$volumeBtn.find("span").removeClass(i.iconVolumeOff).addClass(i.iconVolumeOn))}}).slider("widget").addClass(s.wijCSS.stateDefault),e.$wijvideoControl.hide(),e._initToolTip(),s.showControlsOnHover||(e.$wijvideoControl.show(),e.$vidParent.height(e.$video.outerHeight()+e.$wijvideoControl.height()))),e._isDisabled()&&(e.$disabledDiv&&(e.$disabledDiv.remove(),e.$disabledDiv=null),e._handleDisabledOption(!0,e.element))},200)},t.prototype._bindEvents=function(){var e=this,t,i=e.options.wijCSS,s=e.options;e.$video.bind("click."+e.widgetName,function(){e._togglePlay()}),s.showControlsOnHover&&e.$vidParent.hover(function(){e.$wijvideoControl.stop(!0,!0).fadeIn()},function(){e.$wijvideoControl.delay(300).fadeOut()}),t=e.$vidParent.find("."+r.wijvideoPlayClass+" > span"),t.click(function(){e._togglePlay()}).parent().hover(function(){n(this).addClass(i.stateHover)},function(){n(this).removeClass(i.stateHover)}),e.$vidParent.find("."+r.wijvideoVolumeClass).hover(function(){n("."+r.wijvideoVolumeContainerClass).stop(!0,!0).slideToggle()}),e.$fullScreenBtn=e.$vidParent.find("."+r.wijvideoFullScreenClass+" > span"),e.$fullScreenBtn.click(function(){e._toggleFullScreen()}).parent().hover(function(){n(this).addClass(i.stateHover)},function(){n(this).removeClass(i.stateHover)}),e.options.fullScreenButtonVisible||e.$vidParent.find("."+r.wijvideoFullScreenClass).hide(),e.$volumeBtn.hover(function(){n(this).addClass(i.stateHover)},function(){n(this).removeClass(i.stateHover)}).click(function(){e._getVideoAttribute("readyState")&&(e._volumnOn=!e._volumnOn,e._volumnOn?(e.$volumeSlider.slider("value",e._currentVolumn?e._currentVolumn:1),e._setVideoAttribute("volume",e._currentVolumn?e._currentVolumn:1),e.$volumeBtn.find("span").removeClass(i.iconVolumeOff).addClass(i.iconVolumeOn)):(e._currentVolumn=e.$volumeSlider.slider("value"),e.$volumeSlider.slider("value",0),e._setVideoAttribute("volume",0),e.$volumeBtn.find("span").removeClass(i.iconVolumeOn).addClass(i.iconVolumeOff)))}),e.$video.bind("play."+e.widgetName,function(){t.removeClass(i.icon+" "+i.iconPlay).addClass(i.icon+" "+i.iconPause)}),e.$video.bind("pause."+e.widgetName,function(){t.removeClass(i.icon+" "+i.iconPause).addClass(i.icon+" "+i.iconPlay)}),e.$video.bind("ended."+e.widgetName,function(){e.pause()}),e.$video.bind("timeupdate."+e.widgetName,function(){e._updateTime()})},t.prototype._layout=function(){var e=this,t=e.element;e._createVideoDom(),e.$vidParent=e.$video.parent("."+r.wijvideoClass),e.$vidParent.width(e.$video.outerWidth()).height(e.$video.outerHeight()),e.$wijvideoControl=e.$video.parent().find("."+r.wijvideoControlsClass),e._volumnOn=!0,e.$volumeBtn=e.$vidParent.find("."+r.wijvideoVolumeClass),e._initialSlideControl(),t.is(":hidden")&&t.wijAddVisibilityObserver&&t.wijAddVisibilityObserver(function(){e._refresh(),t.wijRemoveVisibilityObserver&&t.wijRemoveVisibilityObserver()},"wijvideo")},t.prototype._create=function(){var t=this,r=t.element;r.is("video")?t.$video=r:t.$video=r.find("video"),t.$video.attr("aria-label","video");if(!t.$video||t.$video.length===0||n.browser.msie&&parseInt(n.browser.version,10)<9)return;if(!t.$video[0].canPlayType)return;t._layout(),t._bindEvents(),t._videoIsControls=!1,t._getVideoAttribute("controls")&&(t._videoIsControls=!0),t.$video.removeAttr("controls"),e.prototype._create.call(this)},t.prototype._setOption=function(t,n){var i=this,s=i.options,o=i.$video.parent().find("."+r.wijvideoControlsClass),u=i.$video.parent().find("."+r.wijvideoFullScreenClass);e.prototype._setOption.call(this,t,n),t==="fullScreenButtonVisible"?(s.fullScreenButtonVisible=n,n?u.show():u.hide()):t==="showControlsOnHover"&&(n?(this.$vidParent.height(this.$video.outerHeight()),o.hide(),i.$vidParent.hover(function(){o.stop(!0,!0).fadeIn()},function(){o.delay(300).fadeOut()})):(i.$vidParent.unbind("mouseenter mouseleave"),o.show(),i.$vidParent.height(i.$video.outerHeight()+o.height())))},t.prototype._innerDisable=function(){e.prototype._innerDisable.call(this);if(!this._getVideoAttribute("readyState"))return;this._handleDisabledOption(!0,this.element)},t.prototype._innerEnable=function(){e.prototype._innerEnable.call(this),this._handleDisabledOption(!1,this.element)},t.prototype._handleDisabledOption=function(e,t){var n=this,i=n.$video.parent().find("."+r.wijvideoControlsClass);n.$vidParent.toggleClass(this.options.wijCSS.stateDisabled,e),e?(n.$disabledDiv||(n.$disabledDiv=n._createDisabledDiv(t)),n.$disabledDiv.appendTo("body"),n.pause()):n.$disabledDiv&&(n.$disabledDiv.remove(),n.$disabledDiv=null)},t.prototype._createDisabledDiv=function(e){var t=this.$vidParent,r=t.offset(),i=t.outerWidth(),s=t.outerHeight();return n("<div></div>").addClass(this.options.wijCSS.stateDisabled).css({"background-color":"lightgray","z-index":"99999",position:"absolute",width:i,height:s,left:r.left,top:r.top})},t.prototype._getVideoAttribute=function(e){return e===""?null:this.$video.prop(e)},t.prototype._setVideoAttribute=function(e,t){return e===""?null:this.$video.prop(e,t)},t.prototype._initToolTip=function(){var e=this,t=e.options.wijCSS,n=[r.wijvideoClass,t.wijvideo].join(" ");this.$seekSlider.wijtooltip({mouseTrailing:!0,showCallout:!1,position:{offset:"-60 -60"}}),this.$seekSlider.bind("mousemove",function(t){e._seekSliderSkimming(t)}),this.$volumeBtn.wijtooltip({content:e._localizeString("volumeToolTip","Volume"),showCallout:!1}),this.$fullScreenBtn.wijtooltip({content:e._localizeString("fullScreenToolTip","Full Screen"),showCallout:!1}),this.$seekSlider.wijtooltip("widget").addClass(n),this.$volumeBtn.wijtooltip("widget").addClass(n),this.$volumeBtn.wijtooltip("widget").addClass(n)},t.prototype._updateTime=function(){var e=this,t=e._getVideoAttribute("currentTime");e.$vidParent.find("."+r.wijvideoTimerClass).html(e._getTimeString(t)),!e._seeking&&e.$seekSlider.data("ui-slider")&&e.$seekSlider.slider("value",t)},t.prototype._togglePlay=function(){var e=this;if(!e._getVideoAttribute("readyState"))return;e._getVideoAttribute("paused")?e.play():e.pause()},t.prototype._toggleFullScreen=function(){var e=this,t=e.options.wijCSS,i=e._getVideoAttribute("paused"),s,o=n(window).width(),u=n(window).height();e._fullScreen=!e._fullScreen,e._fullScreen?(e._oriVidParentStyle=e.$vidParent.attr("style"),e._oriWidth=e.$video.outerWidth(),e._oriHeight=e.$video.outerHeight(),e._oriDocOverFlow=n(document.documentElement).css("overflow"),n(document.documentElement).css({overflow:"hidden"}),e.$replacedDiv||(e.$replacedDiv=n("<div />")),e.$vidParent.after(e.$replacedDiv),e.$vidParent.addClass(r.wijvideoContainerFullScreenClass).addClass(t.wijvideoContainerFullScreen).css({width:o,height:u}).appendTo(n("body")),e.$video.attr("width",o).attr("height",u),n(window).bind("resize.wijvideo",function(){e._adjustFullScreen()}),s=o-e._oriWidth):(n(document.documentElement).css({overflow:e._oriDocOverFlow}),s=e._oriWidth-e.$video.width(),e.$replacedDiv.after(e.$vidParent).remove(),e.$vidParent.removeClass(r.wijvideoContainerFullScreenClass).removeClass(t.wijvideoContainerFullScreen).attr("style",e._oriVidParentStyle),e.$video.attr("width",e._oriWidth).attr("height",e._oriHeight),n(window).unbind("resize.wijvideo")),e._positionControls(s),e._hideToolTips(),i?e.pause():e.play()},t.prototype._adjustFullScreen=function(){var e=this,t=n(window).width(),r=n(window).height(),i=t-e.$vidParent.width();e.$vidParent.css({width:t,height:r}),e.$video.attr("width",t).attr("height",r),e._positionControls(i)},t.prototype._positionControls=function(e){var t=this.$vidParent.find("."+r.wijvideoIndexSliderClass);t.width(t.width()+e)},t.prototype._seekSliderSkimming=function(e){var t=this,n=e.pageX,r=t.$seekSlider.offset().left,i=t.$seekSlider.width(),s=n-r,o=t._getVideoAttribute("duration"),u=o*(s/i);t.$seekSlider.wijtooltip("option","content",t._getTimeString(u))},t.prototype._hideToolTips=function(){this.$seekSlider.data("wijmo-wijtooltip")&&this.$seekSlider.wijtooltip("hide"),this.$volumeBtn.data("wijmo-wijtooltip")&&this.$volumeBtn.wijtooltip("hide"),this.$fullScreenBtn.data("wijmo-wijtooltip")&&this.$fullScreenBtn.wijtooltip("hide")},t.prototype._localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},t.prototype._getTimeString=function(e){var t="",n="",r=parseInt((e/60).toString(),10),i=parseInt((e-r*60).toString(),10);return r<10&&(t="0"),i<10&&(n="0"),t+r+":"+n+i},t.prototype._refresh=function(){var e,t=this.$video.parent().find("."+r.wijvideoControlsClass);t.show(),e=this.$vidParent.find("."+r.wijvideoTimerClass).position().left,this.$seekSlider.width(e-this.$seekSlider.position().left-15),t.hide(),this.options.showControlsOnHover||(t.show(),this.$vidParent.height(this.$video.outerHeight()+t.height()))},t.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),t.$vidParent.after(t.$video).remove(),t.$video.unbind("."+t.widgetName),t._videoIsControls&&t._setVideoAttribute("controls",!0),t.$disabledDiv&&(t.$disabledDiv.remove(),t.$disabledDiv=null)},t.prototype.play=function(){var e=this.$video[0];e.play()},t.prototype.pause=function(){var e=this.$video[0];e.pause()},t.prototype.getWidth=function(){return this.$video.outerWidth()},t.prototype.setWidth=function(e){var t=this.getWidth();e=e||600,this.$video.attr("width",e),this.$vidParent.width(this.$video.outerWidth()),this._positionControls(this.getWidth()-t)},t.prototype.getHeight=function(){return this.$video.outerHeight()},t.prototype.setHeight=function(e){e=e||400,this.$video.attr("height",e),this.options.showControlsOnHover?this.$vidParent.height(this.$video.outerHeight()):this.$vidParent.height(this.$video.outerHeight()+this.$video.parent().find("."+r.wijvideoControlsClass).height())},t}(e.wijmoWidget);t.wijvideo=i;var s=function(){function e(){this.initSelector=":jqmData(role='wijvideo')",this.wijCSS={iconVolumeOn:"ui-icon-volume-on",iconVolumeOff:"ui-icon-volume-off",wijvideo:"",wijvideoWrapper:"",wijvideoControls:"",wijvideoPlay:"",wijvideoIndex:"",wijvideoIndexSlider:"",wijvideoTimer:"",wijvideoVolume:"",wijvideoVolumeContainer:"",wijvideoVolumeSlider:"",wijvideoFullScreen:"",wijvideoContainerFullScreen:""},this.fullScreenButtonVisible=!0,this.showControlsOnHover=!0,this.localization=null}return e}();i.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new s),n.wijmo.registerWidget("wijvideo",i.prototype)})(e.video||(e.video={}));var t=e.video})(wijmo||(wijmo={}));