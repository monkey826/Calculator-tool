var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},wijmo;(function(e){(function(t){var n=jQuery,r="wijtree",i="wijtreenode",s={wijtreeInner:"wijmo-wijtree-inner"},o=function(e){var t=[];for(var n=0;n<arguments.length-1;n++)t[n]=arguments[n+1];return e.replace(/{(\d+)}/g,function(e,n){return typeof t[n]!="undefined"?t[n]:e})},u=function(e,t){var r=n.wijmo.wijtreenode.prototype.options.wijCSS,i="<div class='wijmo-checkbox ui-widget' role='checkbox'><div class='wijmo-checkbox-box ui-widget ui-corner-all {0}' style='position: relative;'><span class='{1}'></span></div></div>",s=[r.stateDefault],u=["wijmo-checkbox-icon"];return t==="triState"||t==="indeterminate"?(s.push(r.stateActive),u.push(r.icon),u.push(r.iconStop)):e&&(s.push(r.stateActive),u.push(r.icon),u.push(r.iconCheck)),o(i,s.join(" "),u.join(" "))},a=function(e,t,r){typeof r=="undefined"&&(r=!1);var i="",o=n.wijmo.wijtreenode.prototype.options;return n.each(e,function(e,f){if(!n.isPlainObject(f))return!0;var l=f.navigateUrl||"#",c=f.nodes&&f.nodes.length>0,h=f.expanded===null||f.expanded===undefined?o.expanded:f.expanded,p=f.wijCSS===null||f.wijCSS===undefined?o.wijCSS:f.wijCSS,d="<li class='"+(c?"wijmo-wijtree-parent":"wijmo-wijtree-item")+"'><div class='wijmo-wijtree-node "+p.stateDefault+(c?" wijmo-wijtree-header ":"")+(t&&c?h?"wijmo-state-expanded":"wijmo-state-collapsed":"")+"' role='treeitem' aria-expanded='false' aria-checked='false' aria-selected='false'><span class='"+s.wijtreeInner+" "+p.wijtreeInner+" "+p.helperClearFix+" "+p.cornerAll+"'>";c&&(d+="<span class='wijmo-wijtree-hitarea "+(t?p.icon+" "+(h?p.iconArrowRightDown:p.iconArrowRight):"")+"'></span>"),d+="<span class='wijmo-wijtree-nodeimage'></span>",r&&(d+=u(f.checked,f.checkState)),d+=n.browser.safari?"<a href='"+l+"'>":"<a class='wijmo-wijtree-link' href='"+l+"'>",typeof f.text=="string"&&f.text&&(d+="<span>"+f.text+"</span>"),d+="</a></span></div>",c&&(d+="<ul class='wijmo-wijtree-list wijmo-wijtree-child "+p.helperReset+"'",t&&!h&&(d+=" style='display: none'"),d+=">",d+=a(f.nodes,t,r),d+="</ul>"),d+="</li>",i+=d}),i},f=function(e,t,r,i,s){return n.fn[i]&&(e.data("owner",r),!!t&&n.isPlainObject(t)?(n.extend(t,{treeClass:s}),e[i](t)):e[i]({treeClass:s})),e},l=function(e,t,r,i,s){return n.fn[i]?(f(e,t,r,i,s),e.data(e.data("widgetName"))):null},c=function(e,t){if(t==undefined)return;return e.each(function(){this.innerHTML="",n(this).append(t)})},h=function(e){var t=e.data(e.data("widgetName"));return n.isPlainObject(t)?null:t},p=function(e,t){t?e.removeAttr("tabindex"):e.attr("tabindex")!=="-1"&&e.attr("tabindex","-1")},d=function(e){n(e).find(".wijmo-wijtree-node").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-checked").removeAttr("aria-selected")},v=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._create=function(){window.wijmoApplyWijTouchUtilEvents&&(n=window.wijmoApplyWijTouchUtilEvents(n)),this._initState(),this._createTree(),this._attachEvent(),this._attachNodeEvent(),e.prototype._create.call(this)},t.prototype._setOption=function(t,n){var r=this,i=!1,s=r.options,o;switch(t){case"allowDrag":r._setAllowDrag(n);break;case"allowDrop":r._setAllowDrop(n);break;case"showCheckBoxes":r._setCheckBoxes(n);break;case"showExpandCollapse":r.options.showExpandCollapse!==n&&(i=!0);break;default:}e.prototype._setOption.call(this,t,n),t==="nodes"&&(n&&n.length?r._createChildNodes():r._clearChildNodes()),i===!0&&r._setHitArea(n)},t.prototype._innerDisable=function(){e.prototype._innerDisable.call(this),this._toggleDisableTree(!0)},t.prototype._innerEnable=function(){e.prototype._innerEnable.call(this),this._toggleDisableTree(!1)},t.prototype._toggleDisableTree=function(e){this._setAllowDrag(!e)},t.prototype._initState=function(){var e=this,t=e.options;e._selectedNodes=[],e._checkedNodes=[],t.nodes||(t.nodes=[]),e._insertPosition="unKnown",e.nodeWidgetName="wijtreenode"},t.prototype._initVariable=function(){var e=this;e._creatingNode=!1,e._allNodesCreated=!1,e._initNodesCreated=!1,e._initializingTree=!1,e._nextNodeIndex=0,e._nodesCntPerPage=0,e._totalNodesCreated=0},t.prototype._createTree=function(){var e=this,t=e.options,r=["wijmo-wijtree",t.wijCSS.widget,t.wijCSS.content,t.wijCSS.helperClearFix,t.wijCSS.cornerAll].join(" "),i=["wijmo-wijtree-list ",t.wijCSS.helperReset,t.showExpandCollapse?"":"wijmo-wijtree-allexpanded"].join(" "),s=e.element;s.is("ul")?(e.$nodes=s,s.wrap("<div></div>"),e.widgetDom=s.parent()):s.is("div")&&(e.widgetDom=s,e.$nodes=e.widgetDom.children("ul").eq(0)),e.$nodes.length&&(e.widgetDom.addClass(r),e.$nodes.addClass(i),e._createChildNodes(),e.widgetDom.append(n("<div>").css("clear","both")),p(e.element.find(".wijmo-wijtree-link:gt(0)"),!1),e.options.nodes.length>0&&e.widgetDom.attr({role:"tree","aria-multiselectable":!0}))},t.prototype._clearChildNodes=function(){this.$nodes.empty(),this.nodes&&this.nodes.length&&(this.nodes.length=0)},t.prototype._getItemHeight=function(){return this.$nodes.children("li:first").children(".wijmo-wijtree-node").outerHeight(!0)},t.prototype._createNodesAtIdle=function(){this._creatingNode||this._createNodesPartially(!1);return},t.prototype._createNodesPartially=function(e){this._creatingNode=!0;if(this._allNodesCreated||!this.options.nodes||!this.options.nodes.length){this._unbindCreateNodesEvent();return}var t=this,r={nIndex:undefined,htmlGenerated:!0},i,s=t.$nodes.children("li"),o,u=t._totalNodesCreated;i=t._getField("nodes");if(!i)return;while(t._nextNodeIndex<s.length){if(i[t._nextNodeIndex]!=null){t._nextNodeIndex++;continue}r.nIndex=t._nextNodeIndex,o=l(n(s[t._nextNodeIndex]),r,t,t.nodeWidgetName,t.widgetFullName),i[t._nextNodeIndex]=o,t._nextNodeIndex++;if(!e&&u+t._nodesCntPerPage<t._totalNodesCreated)break}this._nextNodeIndex>=s.length&&(this._unbindCreateNodesEvent(),this._allNodesCreated=!0),this._creatingNode=!1},t.prototype._bindCreateNodesEvent=function(){var e=this;n(document).bind("scroll."+this.widgetName,n.proxy(e._createNodesAtIdle,e)).bind("mousemove."+this.widgetName,n.proxy(e._createNodesAtIdle,e)).bind("click."+this.widgetName,n.proxy(e._createNodesAtIdle,e)).bind("keydown."+this.widgetName,n.proxy(e._createNodesAtIdle,e))},t.prototype._unbindCreateNodesEvent=function(){n(document).unbind("."+this.widgetName)},t.prototype._createChildNodes=function(){var e=this,t=e.options,r={nIndex:undefined,htmlGenerated:!1},i=[],s=e.$nodes,o,u,f;t.nodes&&t.nodes.length?(e._initVariable(),c(s,a(t.nodes,t.showExpandCollapse,t.showCheckBoxes)),e._nodesCntPerPage=document.documentElement.clientHeight/e._getItemHeight(),r.htmlGenerated=!0,e._initializingTree=!0,o=s.children("li"),o.each(function(t,s){f=n(s),r.nIndex=t,e._initNodesCreated?(u=null,e._allNodesCreated=!1):(u=l(f,r,e,e.nodeWidgetName,e.widgetFullName),e._nextNodeIndex++),i.push(u),e._totalNodesCreated>=e._nodesCntPerPage*2&&(e._initNodesCreated=!0)}),e._initializingTree=!1,e._allNodesCreated=e._nextNodeIndex>=o.length,e._allNodesCreated||e._bindCreateNodesEvent()):(o=s.children("li"),o.each(function(s,o){f=n(o),u=l(f,r,e,e.nodeWidgetName,e.widgetFullName),i.push(u),!n.browser.safari&&u.$navigateUrl&&u.$navigateUrl.length&&u.$navigateUrl.is("a")&&u.$navigateUrl.addClass("wijmo-wijtree-link"),t.nodes.push(u.options)})),e._hasChildren=i.length>0,e._setField("nodes",i),e.nodes=i},t.prototype._createNodeWidget=function(e,t){return f(e,t,this,this.nodeWidgetName,this.widgetFullName)},t.prototype._attachEvent=function(){this._attachDroppable()},t.prototype._attachDroppable=function(){var e=this,t=e.options,r=t.droppable,i={accept:"li",scope:"tree"},s={drop:function(i,s){var u=s.draggable,a=e._getNodeWidget(u),f,l,c,h,p,d,v,m=-1,g=a._tree.options.showCheckBoxes;r=t.droppable;if(e._trigger("nodeBeforeDropped",i,s)===!1||!a||e._isDisabled()){e._isDragging=!1;return}f=a._dropTarget,l=a._insertPosition;if(f&&l!=="unKnown"){c=a._getOwner(),c&&(v=u.index()),a._tree._isDragging=!1;if(l==="end")m=f.getNodes().length,h=f;else if(l==="before"||l==="after")h=f._getOwner(),p=h.getNodes(),d=n.inArray(f,p),d!==-1&&(m=l==="before"?d:d+1);if(!h._isAllowDrop()){e._isDragging=!1;return}r&&n.isFunction(r.drop)?(s.oldParent=c.element,s.newParent=h.element,s.oldIndex=v,s.newIndex=m,r.drop.call(e.element,i,s)):(c&&c.remove(u),m!==-1&&((l==="before"||l==="after")&&d!==n.inArray(f,p)&&m--,e.$nodes.children("li").length?h.add(u,m):e.add(u,m))),g!==e.options.showCheckBoxes&&a._setCheckBoxes(e.options.showCheckBoxes),n("a",u).eq(0).blur(),a.options.selected&&a._setSelected(!1),o(c),o(h),n.extend(s,{sourceParent:c?c.element:null,sIndex:v,targetParent:h.element,tIndex:m,widget:a}),e._trigger("nodeDropped",i,s)}}},o=function(t){!t.element.is(":"+e.widgetFullName)&&t.getNodes().length>0&&t._tree.options.showCheckBoxes&&t._tree.options.allowTriState&&t.getNodes()[0]._setParentCheckState()};n.extend(i,r,s),n.fn.droppable&&e.widgetDom.droppable(i)},t.prototype._attachNodeEvent=function(){this.element.bind("focusin."+this.widgetName,n.proxy(this._onFocus,this)).bind("focusout."+this.widgetName,n.proxy(this._onBlur,this)).bind("click."+this.widgetName,n.proxy(this._onClick,this)).bind("mouseover."+this.widgetName,n.proxy(this._onMouseOver,this)).bind("mouseout."+this.widgetName,n.proxy(this._onMouseOut,this)).bind("keydown."+this.widgetName,n.proxy(this._onKeyDown,this))},t.prototype._onClick=function(e){this._callEvent(e,"_onClick"),n.browser.webkit&&this.widgetDom.focus()},t.prototype._onFocus=function(e){var t;e.data||(t=this._getNodeByDom(e.target),e.data=t.data(t.data("widgetName"))),this._callEvent(e,"_onFocus")},t.prototype._onBlur=function(e){var t;e.data||(t=this._getNodeByDom(e.target),e.data=t.data(t.data("widgetName"))),this._callEvent(e,"_onBlur")},t.prototype._onKeyDown=function(e){this._callEvent(e,"_onKeyDown")},t.prototype._onMouseOut=function(e){this._callEvent(e,"_onMouseOut")},t.prototype._onMouseOver=function(e){this._callEvent(e,"_onMouseOver")},t.prototype._callEvent=function(e,t){!this._allNodesCreated&&this.options.nodes&&this.options.nodes.length&&this._createNodesAtIdle();var n=e.target,r;if(n){r=this._getNodeWidgetByDom(n);if(r===null)return;r._hasChildren&&r._getField("nodes")&&!r._allNodesCreated&&r.options.nodes&&r.options.nodes.length&&r._createChildNodesAtIdle(),r[t](e)}},t.prototype._nodeSelector=function(){return":wijmo-wijtreenode"},t.prototype.getSelectedNodes=function(){return this._selectedNodes},t.prototype.getCheckedNodes=function(){var e=this,t=[],r=e.nodeWidgetName;return n(e._nodeSelector(),e.element).each(function(e,i){n(i)[r]("option","checked")&&n(i)[r]("option","checkState")!=="indeterminate"&&t.push(n(i))}),t},t.prototype.destroy=function(){var t=this,r=t.$nodes,i=t.options,s=["wijmo-wijtree",i.wijCSS.widget,i.wijCSS.content,i.wijCSS.helperClearFix,i.wijCSS.cornerAll].join(" ");t.widgetDom.removeClass(s).removeAttr("role").removeAttr("aria-multiselectable"),p(t.element.find(".wijmo-wijtree-link"),!0),t.widgetDom.data("ui-droppable")&&t.widgetDom.droppable("destroy"),t._unbindCreateNodesEvent(),t.element.unbind("."+t.widgetName),t.widgetDom.children("div[style]:last").remove(),r.removeData("nodes").removeClass("wijmo-wijtree-list "+i.wijCSS.helperReset),r.children("li").each(function(e,r){var i=t._getNodeWidget(n(r));i&&i.destroy()}),n.wijmo.wijtree.prototype.options.nodes=null,e.prototype.destroy.call(this)},t.prototype.add=function(e,t){var r=null,i={},s,o=this,u,a,f,l,c;n.browser.safari?f="<li><a href='{0}'>{1}</a></li>":f="<li><a href='{0}' class='wijmo-wijtree-link'>{1}</a></li>",typeof e=="string"?(s=n(f.replace(/\{0\}/,"#").replace(/\{1\}/,e)),o._createNodeWidget(s,i),r=s.data(s.data("widgetName"))):e.jquery?(e.data("widgetName")||o._createNodeWidget(e,i),r=e.data(e.data("widgetName")),r._setField("owner",o)):e.nodeType?(s=n(e),o._createNodeWidget(s,i),r=s.data(s.data("widgetName"))):n.isPlainObject(e)&&(s=n(f.replace(/\{0\}/,e.url?e.url:"#").replace(/\{1\}/,e.text)),e.isAddedNodeWithOptions=!0,o._createNodeWidget(s,e),r=s.data(s.data("widgetName")));if(r===null)return;a=o.nodes.length,(!t||t>a)&&t!==0&&(t=a),l=r.getNodes(),r._tree=o;for(u=0;u<l.length;u++)l[u]._tree=o;a>0&&a!==t?(c=this.$nodes.find(">li:eq("+t+")"),r.element.get(0)!==c.get(0)&&r.element.insertBefore(c)):o.$nodes.append(r.element),o._changeCollection(t,r),r._initNodeClass()},t.prototype.remove=function(e){var t=-1,r,i=this.$nodes.children("li");e&&e.jquery?t=e.index():typeof e=="number"&&(t=e);if(t<0||t>=this.nodes.length)return;r=this.nodes[t],r?(r.element.detach(),d(r.element)):(n(i[t]).detach(),d(i[t])),this._changeCollection(t)},t.prototype._changeCollection=function(e,t){var n=this.nodes,r=this.options.nodes,i=this.widgetDom;t?(n.splice(e,0,t),r.splice(e,0,t.options)):(n.splice(e,1),r.splice(e,1)),n.length===0?(i.removeAttr("role"),i.removeAttr("aria-multiselectable")):(i.attr("role","tree"),i.attr("aria-multiselectable",!0))},t.prototype.getNodes=function(){return this.options.nodes&&this.options.nodes.length&&this._createNodesPartially(!0),this.nodes},t.prototype._createParentNodes=function(e){var t=this,r={nIndex:undefined,htmlGenerated:!0},i,s=[],o=e;if(o.closest("ul").parent().hasClass("wijmo-wijtree"))r.nIndex=this.element.children("li").index(o),l(o,r,t,t.nodeWidgetName,t.widgetFullName);else{while(!o.closest("ul").parent().hasClass("wijmo-wijtree")){o=o.closest("ul").closest("li"),s.push(o);if(h(o))break}s.reverse(),n.each(s,function(e,n){i=h(n),i||(r.nIndex=n.parent().children("li").index(n),i=l(n,r,t,t.nodeWidgetName,t.widgetFullName)),i._createChildNodeWidget()})}return h(e)},t.prototype.findNodeByText=function(e){var t=this,r=n(".wijmo-wijtree-node a>span",this.$nodes).filter(function(){return n(this).text()===e}),i=null,s;return r.length&&(s=r.eq(0).closest("li"),i=h(s),i||(i=t._createParentNodes(s))),i},t.prototype._setAllowDrag=function(e){var t=this,r,i=t._nodeSelector(),s="wijmo-"+t.nodeWidgetName;if(!n.fn.draggable)return;e?(r=t.element.find(i),r.each(function(){var e=n(this).data(s);!n(this).data("ui-draggable")&&e.options.allowDrag!==!1&&(!e.$navigateUrl.data("events")||!e.$navigateUrl.data("events").mousedown)&&e.$navigateUrl.one("mousedown."+e.widgetName,e,e._onMouseDown)})):(r=t.element.find(i+":ui-draggable"),r.each(function(){var e=n(this).data(s);e.options.allowDrag||n(this).draggable("destroy")}))},t.prototype._setAllowDrop=function(e){if(!n.fn.droppable)return;this.widgetDom.data("ui-droppable")||this._attachDroppable()},t.prototype._setCheckBoxes=function(e){var t=this;n.each(t.getNodes(),function(t,n){n._setCheckBoxes(e)})},t.prototype._setHitArea=function(e){var t=this;t.$nodes[e?"addClass":"removeClass"]("wijmo-wijtree-allexpanded"),t.$nodes.children("li").each(function(r,i){var s=t._getNodeWidget(n(i));s!==null&&s._setHitArea(e)})},t.prototype._getNodeWidget=function(e){if(e.is(this._nodeSelector())){var t=e.data(e.data("widgetName"));return t}return null},t.prototype._getNodeWidgetByDom=function(e){var t=this._getNodeByDom(e);return this._getNodeWidget(t)},t.prototype._getNodeByDom=function(e){return n(e).closest(this._nodeSelector())},t.prototype._refreshNodesClass=function(){var e=this.getNodes(),t;for(t=0;t<e.length;t++)e[t]._initNodeClass()},t.prototype._getField=function(e){return this.element.data(e)},t.prototype._setField=function(e,t){this.element.data(e,t)},t.prototype._isAllowDrop=function(){return this.options.allowDrop},t}(e.wijmoWidget);t.wijtree=v;var m=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype._setOption=function(e,r){var i=this,s;switch(e){case"accessKey":i.$navigateUrl!==null&&i.$navigateUrl.attr("accesskey",r);break;case"checked":i.options[e]!==r&&i._checkClick();break;case"collapsedIconClass":case"expandedIconClass":case"itemIconClass":i.options[e]=r,i._initNodeImg();break;case"expanded":i._setExpanded(r);break;case"selected":i._setSelected(r);break;case"text":i._setText(r);break;case"toolTip":i._setToolTip(r);break;case"navigateUrl":i._setNavigateUrlHref(r);break;case"allowDrag":i._setAllowDrag(r);break;default:}e==="nodes"?(i.options.nodes.length=0,i._setField("nodes",null),i._setNodes=!0,n.each(r,function(e,t){i.options.nodes.push(t)}),i.options.nodes.concat(),r&&r.length?(i._hasChildren=i._hasSubNodes(),i._createChildNodes(),i._initNodeClass()):i._clearChildNodes()):t.prototype._setOption.call(this,e,r)},r.prototype._initVariable=function(){var e=this;e._allNodesCreated=!1,e._initNodesCreated=!1,e._nextNodeIndex=0},r.prototype._initState=function(){var e=this;e._tree=null,e._dropTarget=null,e._checkState="unChecked",e._insertPosition="unKnown",e.$nodeBody=null,e.$checkBox=null,e.$hitArea=null,e.$nodes=null,e.$subnodes=null},r.prototype._create=function(){var e=this,n=e.options;e._setNodes=n.isAddedNodeWithOptions,e._initState(),e.element.data("widgetName","wijmo-wijtreenode"),e._createTreeNode(),e._initNode(),n.selected&&e._tree._selectedNodes.push(e),n.checked&&(e._checkState="checked"),t.prototype._create.call(this)},r.prototype._createTreeNode=function(){var e=this.element,t,r=this,i,o=r.options;r._tree===null&&(r._tree=r._getTree()),isNaN(o.nIndex)?o.nodes||(o.nodes=[]):(i=r._getOwner().options,t=i.nodes[o.nIndex],t&&!t.nodes&&(t.nodes=[]),n.extend(o,t),i.nodes[o.nIndex]=o),r._isHtmlGenerated()?(r._tree._totalNodesCreated++,r.$nodeBody=e.children(".wijmo-wijtree-node"),r.$inner=r.$nodeBody.children("."+s.wijtreeInner),r.$nodeImage=r.$inner.children(".wijmo-wijtree-nodeimage"),r._tree.options.showCheckBoxes&&(r.$checkBox=e.find(">div>span>div.wijmo-checkbox"),r.$checkBoxBody=r.$checkBox.children("div"),r.$checkBoxIcon=r.$checkBoxBody.children("span")),r.$navigateUrl=r.$inner.children("a"),r.$text=r.$navigateUrl.children("span").eq(0)):(r.$nodeImage=n("<span>"),r.$nodeBody=n("<div>").attr({role:"treeitem","aria-expanded":!1,"aria-checked":!1,"aria-selected":!1}),r.$navigateUrl=e.children("a"),r.$navigateUrl.length===0&&(r.$navigateUrl=e.children("div"),r.$navigateUrl.addClass("wijmo-wijtree-template"),r._isTemplate=!0),r.$navigateUrl.length===0&&(r.$navigateUrl=n("<a href='#'></a>")),r._isTemplate||(r.$text=r.$navigateUrl.children("span").eq(0),r.$text.length===0&&(r.$navigateUrl.wrapInner("<span></span>"),r.$text=r.$navigateUrl.children("span").eq(0))),r.$inner=n("<span></span>").addClass(o.wijCSS.helperClearFix+" "+s.wijtreeInner+" "+o.wijCSS.wijtreeInner+" "+o.wijCSS.cornerAll),r.$inner.append(r.$nodeImage),r._tree.options.showCheckBoxes&&r._createTreeCheck(),r.$inner.append(r.$navigateUrl),r.$nodeBody.append(r.$inner),e.prepend(r.$nodeBody)),r._hasChildren=r._hasSubNodes(),r._createChildNodes()},r.prototype._clearChildNodes=function(){var e=this._getField("nodes");this.$nodes.empty(),e&&e.length&&(e.length=0),this.$subnodes&&this.$subnodes.length&&(this.$subnodes.length=0)},r.prototype._createChildNodes=function(){var e=this,t=e.options,r=e.element;e._initVariable(),e._hasChildren?(e.$nodes===null&&(e.$nodes=r.children("ul").eq(0)),e._isHtmlGenerated()?e.$hitArea=e.$inner.children(".wijmo-wijtree-hitarea"):(r.addClass("wijmo-wijtree-parent"),e.$nodeBody.addClass("wijmo-wijtree-node wijmo-wijtree-header "+t.wijCSS.stateDefault),e.$hitArea=n("<span>"),e.$inner.prepend(e.$hitArea),e.$nodes.addClass("wijmo-wijtree-list wijmo-wijtree-child "+t.wijCSS.helperReset)),(t.expanded||!e._isHtmlGenerated())&&e._createChildNodeWidget()):(e._isHtmlGenerated()||(r.addClass("wijmo-wijtree-item"),e.$nodeBody.addClass("wijmo-wijtree-node "+t.wijCSS.stateDefault)),e._setField("nodes",[]))},r.prototype._isHtmlGenerated=function(){return!!this.options.htmlGenerated},r.prototype._createInitNode=function(e,t,r,o,u){var a=this,f;return f=h(e),f||(u&&u.push(e),o.nIndex=t,!a._initNodesCreated||!a._isHtmlGenerated()?(f=l(e,o,a,i,a.options.treeClass),!u&&!n.browser.safari&&e.children(".wijmo-wijtree-node").find("."+s.wijtreeInner+" a").addClass("wijmo-wijtree-link"),f._index=t,a._nextNodeIndex++):(f=null,a._allNodesCreated=!1),a._tree._initializingTree?a._tree._totalNodesCreated>=a._tree._nodesCntPerPage*2&&(a._initNodesCreated=!0):a._nextNodeIndex>=a._tree._nodesCntPerPage*2&&(a._initNodesCreated=!0)),a._allNodesCreated=a._nextNodeIndex>=r,f},r.prototype._bindCreateNodesEvent=function(){var e=this;n(document).bind("scroll."+this.widgetName,n.proxy(e._createChildNodesAtIdle,e)).bind("mousemove."+this.widgetName,n.proxy(e._createChildNodesAtIdle,e)).bind("click."+this.widgetName,n.proxy(e._createChildNodesAtIdle,e)).bind("keydown."+this.widgetName,n.proxy(e._createChildNodesAtIdle,e))},r.prototype._unbindCreateNodesEvent=function(){n(document).unbind("."+this.widgetName)},r.prototype._createChildNodesAtIdle=function(){this._tree._creatingNode||this._createChildNodesPartially(!1);return},r.prototype._createChildNodesPartially=function(e){this._tree._creatingNode=!0;var t=this,r={nIndex:undefined,htmlGenerated:!0},s=[],o=t.$nodes.children("li"),u,a=t._nextNodeIndex;t._getField("nodes")?s=t._getField("nodes"):t._setField("nodes",s);if(this._allNodesCreated||!this.options.nodes||!this.options.nodes.length){this._unbindCreateNodesEvent();return}while(t._nextNodeIndex<o.length){if(s[t._nextNodeIndex]!=null){t._nextNodeIndex++;continue}r.nIndex=t._nextNodeIndex,u=l(n(o[t._nextNodeIndex]),r,t,i,t.options.treeClass),s[t._nextNodeIndex]=u,t._nextNodeIndex++;if(!e&&a+t._tree._nodesCntPerPage<t._nextNodeIndex)break}this._nextNodeIndex>=o.length&&(this._unbindCreateNodesEvent(),this._allNodesCreated=!0),this._tree._creatingNode=!1},r.prototype._createChildNode=function(){var e=this,t=e.options,r=[],i,s={nIndex:undefined,cfli:undefined,treeClass:t.treeClass,nodes:undefined,htmlGenerated:e._isHtmlGenerated()};if(e._setNodes&&t.nodes&&t.nodes.length){if(!e.$nodes||!e.$nodes.length)e.$nodes=n("<ul>").appendTo(e.element);c(e.$nodes,a(t.nodes,e._tree.options.showExpandCollapse,e._tree.options.showCheckBoxes)),e.$subnodes=[],s.htmlGenerated=!0,i=e.$nodes.children("li"),i.each(function(t,o){var u=n(o);r.push(e._createInitNode(u,t,i.length,s,e.$subnodes))})}else t.nodes||(t.nodes=[]),e.$subnodes===null&&e._updateSubNodes(),n.each(e.$subnodes,function(t,n){e._isHtmlGenerated()||(s.nodes=[]),r.push(e._createInitNode(n,t,e.$subnodes.length,s))});return e._allNodesCreated||e._bindCreateNodesEvent(),r},r.prototype._initNode=function(){var e=this,t=e.options;e._initialized||(e._initialized=!0,e._initNavigateUrl(),!e._isTemplate&&e.$text&&e.$text.length&&(e._text=e.$text.html(),t.text=e._text),e._hasChildren=e._hasSubNodes(),e._initNodesUL(),e._initNodeClass(),e._initNodeImg(),e._isAllowDrag()&&e.$navigateUrl.one("mousedown."+e.widgetName,e,e._onMouseDown))},r.prototype._initNodeClass=function(){var e=this,t=e.options,r,i="wijmo-wijtree-item",s=t.wijCSS.icon+" "+(t.expanded?t.wijCSS.iconArrowRightDown:t.wijCSS.iconArrowRight);e._tree.options.showExpandCollapse&&(e._hasChildren||!!t.hasChildren?(e._isHtmlGenerated()||(e.$nodeBody.removeClass("wijmo-state-expanded wijmo-state-collapsed"),t.expanded?e.$nodeBody.addClass("wijmo-state-expanded"):e.$nodeBody.addClass("wijmo-state-collapsed")),e.$hitArea!==null?(e.$hitArea.removeClass([t.wijCSS.icon,t.wijCSS.iconArrowRightDown,t.wijCSS.iconArrowRight].join(" ")),e.$hitArea.addClass(s)):(e.$hitArea=n("<span>").addClass(s).prependTo(e.$inner),e.element.removeClass(i).addClass("wijmo-wijtree-parent")),e._hasChildren&&e.$nodes&&e.$nodes.length&&(r=t.expanded?"":"none",e.$nodes.css({display:r}))):e.$hitArea&&e.$hitArea.length&&(e.$hitArea.remove(),e.$hitArea=null,e.element.removeClass("wijmo-wijtree-parent").addClass(i))),!e._hasChildren&&e.$nodes&&e.$nodes.length&&e.$nodes.css({display:"none"}),t.selected&&e.$inner&&e.$inner.addClass(t.wijCSS.stateActive)},r.prototype._initNodesUL=function(){var e=this;!e._isHtmlGenerated()&&e._tree.options.showExpandCollapse&&e._hasChildren&&e.$nodes&&e.$nodes.length&&e.$nodes[e._expanded?"show":"hide"]()},r.prototype._initNavigateUrl=function(){var e=this,t;if(e._isHtmlGenerated())return;t=e.$navigateUrl.attr("href"),this._isTemplate||(!t||t.length===0)&&e._setNavigateUrlHref("#")},r.prototype._applyIconClass=function(e,t){var n=e.attr("expandediconclass");n&&(t.expandedIconClass=n,e.removeAttr("expandediconclass")),n=e.attr("collapsediconclass"),n&&(t.collapsedIconClass=n,e.removeAttr("collapsediconclass")),n=e.attr("itemiconclass"),n&&(t.itemIconClass=n,e.removeAttr("itemiconclass"))},r.prototype._initNodeImg=function(){var e=this,t=e.options,r=e.element;if(e.$nodeImage===null||!e.$nodeImage.length)e.$nodeImage=n("<span>");e._applyIconClass(r,t),t.collapsedIconClass!==""&&t.expandedIconClass!==""?(e.$nodeImage.removeClass().addClass(t.wijCSS.icon).addClass(t.expanded?t.expandedIconClass:t.collapsedIconClass),e._tree.options.showExpandCollapse||e.$nodeImage.addClass(t.expandedIconClass),e.$nodeImage.insertBefore(e.$checkBox)):t.itemIconClass!==""&&(e.$nodeImage.removeClass().addClass(t.wijCSS.icon),e.$nodeImage.addClass(t.itemIconClass),e.$nodeImage.insertBefore(e.$checkBox))},r.prototype._setNavigateUrlHref=function(e){if(this.$navigateUrl){if(e===""||typeof e=="undefined"||e===null)e="#";this.$navigateUrl.attr("href",e)}},r.prototype._editNode=function(){this._tree._editMode=!0,this.$navigateUrl.hide(),this.$editArea||(this.$editArea=n('<input type="text">').wijtextbox()),this.$editArea.val(this.$text.html()),this.$editArea.insertBefore(this.$navigateUrl),this.$editArea.bind("blur",this,this._editionComplete),this.$editArea.focus()},r.prototype._editionComplete=function(e){var t=e.data,n;t._tree._editMode=!1,t.$editArea&&(n=t.$editArea.val(),t.$editArea.remove()),t.$navigateUrl.show(),t.$editArea=null,t._changeText(n)},r.prototype._changeText=function(e){var t=this,n=t.options;t.$text!==null&&e!==""&&(t.$text.text(e),n.text=e,t._tree._trigger("nodeTextChanged",null,t))},r.prototype._toggleExpanded=function(){var e=this,t=e.options;e._isClosestDisabled()||(e._hasChildren||t.hasChildren)&&e._setExpanded(!t.expanded)},r.prototype._createChildNodeWidget=function(){var e=this,t=[];e._getField("nodes")||(e._hasChildren&&(t=e._createChildNode()),e._setField("nodes",t))},r.prototype._expandNode=function(e){var t=this,n=t._tree.options,r=e?"nodeExpanding":"nodeCollapsing";if(t._tree._trigger(r,null,{node:this,params:this.options.params})===!1)return;t._createChildNodeWidget(),t.$nodeBody.attr("aria-expanded",e),t._expanded=e,t.options.expanded=e,t._isClosestDisabled()||(e?n.expandDelay>0?(window.clearTimeout(t._expandTimer),t._expandTimer=window.setTimeout(function(){t._expandNodeVisually()},n.expandDelay)):t._expandNodeVisually():n.collapseDelay>0?(window.clearTimeout(t._collapseTimer),t._collapseTimer=window.setTimeout(function(){t._collapseNodeVisually()},n.collapseDelay)):t._collapseNodeVisually())},r.prototype._expandNodeVisually=function(){var e=this,t,r=e.options;e._tree.options.autoCollapse&&(t=e.element.siblings(":"+this.widgetFullName),n.each(t,function(n){var r=e._getNodeWidget(t[n]);r.options.expanded&&r._setExpanded(!1)})),r.collapsedIconClass!==""&&r.expandedIconClass!==""&&e.$nodeImage.removeClass(r.collapsedIconClass).addClass(r.expandedIconClass),e._internalSetNodeClass(!0),e._show()},r.prototype._collapseNodeVisually=function(){var e=this;e.options.collapsedIconClass!==""&&e.options.expandedIconClass!==""&&e.$nodeImage.removeClass(e.options.expandedIconClass).addClass(e.options.collapsedIconClass),e._tree._focusNode&&e.$nodes.find(e._tree._focusNode.$navigateUrl).length&&e._setFocused(!0),e._internalSetNodeClass(!1),e._hide()},r.prototype._internalSetNodeClass=function(e){var t=this.options.wijCSS,n=[t.icon,t.iconArrowRightDown,t.iconArrowRight].join(" ");if(!this.$hitArea)return;this.$hitArea.removeClass(n).addClass(t.icon).addClass(e?t.iconArrowRightDown:t.iconArrowRight),this.$nodeBody.removeClass("wijmo-state-expanded").removeClass("wijmo-state-collapsed"),e?this.$nodeBody.addClass("wijmo-state-expanded"):this.$nodeBody.addClass("wijmo-state-collapsed")},r.prototype._show=function(){this._animation(!0)},r.prototype._hide=function(){this._animation(!1)},r.prototype._animation=function(e){function l(e){e.css(f)!==a&&e.css(f,a)}var t=this,r=t.$nodes,i=e?"expandAnimation":"collapseAnimation",s=e?"nodeExpanded":"nodeCollapsed",o,u=t._tree.options[i],a,f;r&&r.length&&(u?(n.browser.msie&&parseInt(n.browser.version)<9?f="filter":f="opacity",a=r.css(f),o=u.animated||u.effect,n.effects&&!!o?r[e?"show":"hide"](o,{easing:u.easing},u.duration,function(){l(r),t._tree._trigger(s,null,t)}):r[e?"show":"hide"](u.duration,function(){l(r),t._tree._trigger(s,null,t)})):(r[e?"show":"hide"](),t._tree._trigger(s,null,t)))},r.prototype._getBounds=function(e){var t=e.height(),n=e.width(),r=e.offset().top,i=e.offset().left;return{h:t,w:n,t:r,l:i}},r.prototype._isMouseInsideRect=function(e,t){return e.x<t.l||e.x>=t.l+t.w?!1:e.y<=t.t+1||e.y>=t.t+t.h?!1:!0},r.prototype._getNodeByMouseOn=function(e){var t=this;return n("li").each(function(){var r=t._getBounds(n(this));if(e.y>r.t&&e.y<r.t+r.h&&e.x>r.l&&e.x<r.l+r.w)return n(this)}),null},r.prototype._drowTemplate=function(e,t,n){var r="unKnown",i=n.is(".wijmo-wijtree-node")?n:n.children(".wijmo-wijtree-node"),s=this._getBounds(i);return t.width(i.width()),e.y>s.t&&e.y<s.t+s.h/2?(t.offset({left:s.l,top:s.t}),r="before"):e.y>s.t+s.h/2&&e.y<s.t+s.h&&(t.offset({left:s.l,top:s.t+s.h}),r="after"),r},r.prototype._beginDrag=function(e){var t=this,r=t.element,i,o=t._tree.options,u=o.draggable,a=n("<div>").addClass("wijmo-wijtree-insertion "+o.wijCSS.stateDefault),f={cursor:"point",cursorAt:{top:15,left:-25},helper:function(){return n("<div>"+t.$navigateUrl.html()+"</div>").addClass(o.wijCSS.header).addClass(o.wijCSS.cornerAll)},distance:n.browser.msie?1:10,handle:t.$navigateUrl,scope:"tree"},l={start:function(e,i){t._tree._isDragging=!0,t._tree.widgetDom.prepend(a),t._tree._trigger("nodeDragStarted",e,t),u&&n.isFunction(u.start)?u.start.call(t.element,e,i):r.hide()},drag:function(e,r){var i=e,o=i.srcElement||i.originalEvent.target,f=n(o),l,c={x:i.pageX,y:i.pageY};a&&a.hide(),f&&(l=t._getNodeWidget(o),l&&!l._tree._isDisabled()?(f.closest("."+s.wijtreeInner,t.element).length?t._insertPosition="end":(a.show(),t._insertPosition=t._drowTemplate(c,a,l.element)),l!==t&&(t._dropTarget=l)):f.is(":"+t.options.treeClass)&&(t._dropTarget=f.data(t.options.treeClass),t._insertPosition="end")),t._tree._trigger("nodeDragging",e,t),u&&n.isFunction(u.drag)&&u.drag.call(t.element,e,r)},stop:function(e,i){a.remove(),t._dropTarget=null,t._insertPosition="unKnown",t._tree._isDragging=!1,u&&n.isFunction(u.stop)?u.stop.call(t.element,e,i):(r.show(),t._resetDrag())}};typeof o.dropVisual=="string"?(i=n(o.dropVisual),a=i.length?i:a):n.isFunction(o.dropVisual)&&(i=n(o.dropVisual.call()),a=i.length?i:a),a.hide(),n.extend(f,u,l),n.fn.draggable&&(r.draggable(f).trigger(e),n.browser.mozilla&&t._setFocused(!0))},r.prototype._resetDrag=function(){var e=this,t,n,r=e.options;!e._isAllowDrag()&&e.element.data("ui-draggable")&&e.element.draggable("destroy"),t=e.getNodes();for(n=0;n<t.length;n++)t[n]._resetDrag()},r.prototype._createTreeCheck=function(){var e=this,t=e.options,r=u(t.checked,t.checkState);e.$checkBox=n(r),e.$checkBox.insertAfter(e.$nodeImage),e.$checkBoxBody=e.$checkBox.children("div"),e.$checkBoxIcon=e.$checkBoxBody.children("span")},r.prototype._mouseOverTreeCheck=function(e){var t=n(e.target),r=this,i=r.options,s=i.wijCSS;r._isOverCheckbox(t)&&r.$checkBoxBody.addClass(s.stateHover)},r.prototype._mouseOutTreeCheck=function(e){var t=n(e.target),r=this,i=r.options,s=i.wijCSS;r._isOverCheckbox(t)&&r.$checkBoxBody.removeClass(s.stateHover)},r.prototype._setTreeCheckState=function(e){var t=this,n=t.options,r=n.wijCSS,i=r.icon+" "+r.iconCheck,s=r.icon+" "+r.iconStop;e==="unCheck"?(t.$checkBoxBody.removeClass(r.stateActive),t.$checkBoxIcon.removeClass(i+" "+s)):e==="check"?(t.$checkBoxBody.addClass(r.stateActive),t.$checkBoxIcon.removeClass(s).addClass(i)):e==="triState"&&(t.$checkBoxBody.addClass(r.stateActive),t.$checkBoxIcon.removeClass(i).addClass(s))},r.prototype._checkClick=function(){var e=this,t=e.options;if(!e._isClosestDisabled()){if(e._tree._trigger("nodeCheckChanging",null,e)===!1)return;t.checked&&e._checkState==="indeterminate"?(e._checkState="checked",e._checkItem()):(e._checkState=t.checked?"unChecked":"checked",e._setChecked(!t.checked)),e._tree._trigger("nodeCheckChanged",null,e)}},r.prototype._checkItem=function(){var e=this,t=!1,n=e._tree;if(n===null||!n.options.showCheckBoxes)return;n.options.autoCheckNodes&&e._checkState!=="indeterminate"&&(t=!0,e._changeChecked(e.options.checked)),n.options.allowTriState&&e._setParentCheckState(),e.options.checked?e._checkNode(t):e._unCheckNode(t)},r.prototype._checkNode=function(e){var t=this,n=t.options,r=this.getNodes(),i;t._checkState==="checked"?(t._setTreeCheckState("check"),n.checkState="checked"):t._checkState==="indeterminate"&&(t._setTreeCheckState("triState"),n.checkState="indeterminate");if(e)for(i=0;i<r.length;i++)r[i]._checkNode(!0)},r.prototype._unCheckNode=function(e){var t=this.getNodes(),n=this.options,r;this._setTreeCheckState("unCheck"),n.checkState="unChecked";if(e)for(r=0;r<t.length;r++)t[r]._unCheckNode(!0)},r.prototype._changeChecked=function(e){var t=this.getNodes();n.each(t,function(t,n){n.options.checked=e,n.$nodeBody.attr("aria-checked",e),n._checkState=e?"checked":"unChecked",n._changeChecked(e)})},r.prototype._setParentCheckState=function(){var e=this._getOwner(),t,n=!0,r=!1,i=!1,s,o=this;if(e.element.is(":"+o.options.treeClass))return;t=e.getNodes();for(s=0;s<t.length;s++){t[s]._checkState==="indeterminate"&&(i=!0),t[s].options.checked?r=!0:n=!1;if(!n&&r)break}i?(e._checkState="indeterminate",e._setChecked(!0)):r?(n?(e._checkState="checked",e._checkNode(!1)):e._checkState="indeterminate",e._setChecked(!0)):(e._checkState="unChecked",e._setChecked(!1),e._unCheckNode(!1)),e._setParentCheckState()},r.prototype._isOverCheckbox=function(e){return e.closest(".wijmo-checkbox",this.element).length>0},r.prototype._isWithinHitArea=function(e){return this.$hitArea&&this.$hitArea[0]===e[0]},r.prototype._isOverInner=function(e){return e.closest("."+s.wijtreeInner,this.element).length>0},r.prototype._onKeyDown=function(t){var r=n(t.target),i=this;if(i._isOverInner(r)){if(t.keyCode===e.getKeyCodeEnum().TAB)return!0;i._keyAction(t)}},r.prototype._onClick=function(e){var t=n(e.target),r=this;r._isOverCheckbox(t)?(r._checkClick(),e.preventDefault(),e.stopPropagation()):r._isWithinHitArea(t)?(r._toggleExpanded(),e.preventDefault(),e.stopPropagation()):r._isOverInner(t)&&r._click(e)},r.prototype._onMouseDown=function(e){var t=n(e.target),r=e.data;!r._tree._isDisabled()&&r._isAllowDrag()&&t.closest(".wijmo-wijtree-node",r.element).length>0&&r._beginDrag(e)},r.prototype._onMouseOver=function(e){var t=n(e.target),r=this,i=n(e.relatedTarget);r._isOverInner(t)&&(this._tree._overNode!==r||i.is(":"+this.widgetFullName)||i.is(".wijmo-wijtree-node"))&&(r._isClosestDisabled()||r._mouseOver(e),this._tree._overNode=r),r._isClosestDisabled()||(r._mouseOverHitArea(e),r._mouseOverTreeCheck(e))},r.prototype._onMouseOut=function(e){var t=n(e.target),r=this,i=n(e.relatedTarget),s=this._getNodeWidget(i.get(0));r._isOverInner(t)&&(this._tree._overNode!==s||i.is(":"+this.widgetFullName)||i.is(".wijmo-wijtree-list")||i.is(".ui-effects-wrapper")||i.is(".wijmo-wijtree-node"))&&(r._isClosestDisabled()||r._mouseOut(e),this._tree._overNode=null),r._isClosestDisabled()||(r._mouseOutHitArea(e),r._mouseOutTreeCheck(e))},r.prototype._onFocus=function(e){var t=n(e.target),r=this,i=r.options.wijCSS;r._isOverInner(t)&&!r._isClosestDisabled()&&!t.hasAllClasses(i.iconArrowRightDown)&&!t.hasAllClasses(i.iconArrowRight)&&!r._isOverCheckbox(t)&&(r._tree._focusNode?(r._tree._focusNode.$navigateUrl.trigger("focusout"),p(r._tree._focusNode.$navigateUrl,!1)):p(r._tree.nodes[0].$navigateUrl,!1),p(t,!0),r._focused=!0,r._tree._focusNode=this,r.$inner.addClass(i.stateFocus),r._tree._trigger("nodeFocus",e,r))},r.prototype._onBlur=function(e){var t=n(e.target),r=e.data,i=r.options.wijCSS;r._isClosestDisabled()||(r._focused=!1,r._isOverInner(t)&&r.$inner.removeClass(i.stateFocus),r._tree._trigger("nodeBlur",e,r))},r.prototype._click=function(e){var t=this,r=t.options,i=t._tree,s=t.$navigateUrl.attr("href");if(!t._isClosestDisabled()){if(!/^[#,\s]*$/.test(s)){if(!n.browser.msie||!/^7\.[\d]*/.test(n.browser.version))return;if(s.indexOf(window.location.href)<0)return}t._isClick=!0,i._ctrlKey=e.ctrlKey,r.selected&&i._ctrlKey?t._setSelected(!1):r.selected&&!t._tree._editMode&&i.options.allowEdit&&!t._isTemplate?t._editNode():t._setSelected(!r.selected),t._isTemplate||(e.preventDefault(),e.stopPropagation())}else t._setNavigateUrlHref("")},r.prototype._selectNode=function(e,t){var r=this,i=r.options,s,o;!r._isClosestDisabled()&&!r._tree._isDragging&&(s=r._tree._ctrlKey,s?(o=n.inArray(r,r._tree._selectedNodes),o!==-1&&!e&&(r._tree._selectedNodes.splice(o,1),r.$inner.removeClass(i.wijCSS.stateActive))):(n.each(r._tree._selectedNodes,function(e,t){t.$inner.removeClass(i.wijCSS.stateActive),t.options.selected=!1,t.$nodeBody.attr("aria-selected",!1)}),r._tree._selectedNodes=[]),e?(o=n.inArray(r,r._tree._selectedNodes),o===-1&&this._tree._selectedNodes.push(r),r.$inner.addClass(i.wijCSS.stateActive)):r.$inner.removeClass(i.wijCSS.stateActive),r._isClick&&r._tree._trigger("nodeClick",t,r),r._isClick=!1,r._tree._ctrlKey=!1,r._tree._trigger("selectedNodeChanged",t,r))},r.prototype._keyAction=function(t){var n=t.target,r=this,i=e.getKeyCodeEnum();if(r._isClosestDisabled())return;if(n){if(r._tree._editMode&&t.keyCode!==i.ENTER)return;switch(t.keyCode){case i.UP:r._moveUp();break;case i.DOWN:r._moveDown();break;case i.RIGHT:r._tree.options.showExpandCollapse&&r._moveRight();break;case i.LEFT:r._tree.options.showExpandCollapse&&r._moveLeft();break;case 83:!r._tree._editMode&&r._tree.options.allowSorting&&r.sortNodes();break;case 113:r._tree.options.allowEdit&&r._editNode();break;case 109:r._tree.options.showExpandCollapse&&this._expanded&&r._setExpanded(!1);break;case 107:r._tree.options.showExpandCollapse&&!this._expanded&&r._setExpanded(!0);break;case i.ENTER:r._tree._editMode&&(t.data=r,r._editionComplete(t),r._setFocused(!0),t.preventDefault());break;case i.SPACE:r._tree.options.showCheckBoxes&&r._checkClick()}!r._isTemplate&&t.keyCode!==i.ENTER&&(t.preventDefault(),t.stopPropagation())}},r.prototype._prevNode=function(e){var t=e.element;if(t.prev().length>0)return t.prev().data(t.data("widgetName"))},r.prototype._nextNode=function(e){var t=e.element;if(t.next().length>0)return t.next().data(t.data("widgetName"))},r.prototype._getNextExpandedNode=function(e){var t=e,n=e.getNodes(),r;return e._expanded&&n.length>0&&(r=n[n.length-1],r!==null&&(t=this._getNextExpandedNode(r))),t},r.prototype._getNextNode=function(e){var t=null,n=this;return e.element.is(":"+n.options.treeClass)?null:(t=n._nextNode(e),t?t:n._getNextNode(e._getOwner()))},r.prototype._moveUp=function(){var e=this._getCurrentLevel(),t=this._prevNode(this);t?this._getNextExpandedNode(t)._setFocused(!0):e>0&&this._getOwner()._setFocused(!0)},r.prototype._moveDown=function(){var e=this.getNodes(),t,n,r;this._expanded&&e.length>0?e[0]._setFocused(!0):(t=this._nextNode(this),t?t._setFocused(!0):(n=this._getOwner(),r=this._getNextNode(n),r&&r._setFocused(!0)))},r.prototype._moveLeft=function(){var e=this._getOwner();this._expanded?this._setExpanded(!1):e!==null&&!e.element.is(":"+this.options.treeClass)&&e._setFocused(!0)},r.prototype._moveRight=function(){if(this._hasChildren)if(!this._expanded)this._setExpanded(!0);else{var e=this.getNodes()[0];e!==null&&e._setFocused(!0)}},r.prototype._mouseOver=function(e){var t=this,n=t._tree;n._editMode||(t._mouseOverNode(),n._isDragging||n._trigger("nodeMouseOver",e,t))},r.prototype._mouseOut=function(e){var t=this,n=t._tree;n._editMode||(t._mouseOutNode(),n._isDragging||n._trigger("nodeMouseOut",e,t))},r.prototype._mouseOverNode=function(){this.$inner!==null&&!this._isOverNode&&(this.$inner.addClass(this.options.wijCSS.stateHover),this._isOverNode=!0)},r.prototype._mouseOutNode=function(){this.$inner!==null&&this._isOverNode&&(this.$inner.removeClass(this.options.wijCSS.stateHover),this._isOverNode=!1)},r.prototype._mouseOverHitArea=function(e){var t,n,r=this,i=r._tree;i.options.expandCollapseHoverUsed&&r._hasChildren&&!r._isOverHitArea&&(t=r._getBounds(r.element),n={x:e.pageX,y:e.pageY},r._isMouseInsideRect(n,t)&&(r._isOverHitArea=!0,r._setExpanded(!0)))},r.prototype._mouseOutHitArea=function(e){var t={x:e.pageX,y:e.pageY},n,r=this,i=r._tree;i.options.expandCollapseHoverUsed&&(r._hasChildren&&!!r._isOverHitArea?(n=r._getBounds(r.element),r._isMouseInsideRect(t,n)||(r._isOverHitArea=!1,r._setExpanded(!1))):r._getOwner().element.is(":"+r.widgetFullName)&&(n=r._getBounds(r._getOwner().element),r._isMouseInsideRect(t,n)||(r._getOwner()._isOverHitArea=!1,r._getOwner()._setExpanded(!1))))},r.prototype.destroy=function(){var e=this,r,i=e.options,s;e.element.data("ui-draggable")&&e.element.draggable("destroy"),e.$hitArea&&e.$hitArea.remove(),e.$checkBox&&e.$checkBox.remove(),e.$nodeImage&&e.$nodeImage.remove(),e._unbindCreateNodesEvent(),e.$navigateUrl.unwrap().unwrap().removeClass(i.wijCSS.stateDefault).removeClass(i.wijCSS.stateActive).unbind("mousedown"),r=e.element.find("ul:first").show(),r.removeClass(),r.children("li").each(function(){s=n(this);var e=h(s);e&&e.destroy()}),e.element.removeData("nodes").removeData("owner").removeData("widgetName").removeClass(),t.prototype.destroy.call(this)},r.prototype.add=function(e,t){var r=null,i,o,u=this,a,f,l,c,h,p;n.browser.safari?l="<li><a href='{0}'>{1}</a></li>":l="<li><a href='{0}' class='wijmo-wijtree-link'>{1}</a></li>",typeof e=="string"?(i=n(l.replace(/\{0\}/,"#").replace(/\{1\}/,e)),u._createNodeWidget(i),r=i.data(i.data("widgetName"))):e.jquery?(e.data("widgetName")||u._createNodeWidget(e),r=e.data(e.data("widgetName"))):e.nodeType?(i=n(e),u._createNodeWidget(i),r=i.data(i.data("widgetName"))):n.isPlainObject(e)&&(i=n(l.replace(/\{0\}/,e.url?e.url:"#").replace(/\{1\}/,e.text)),e.isAddedNodeWithOptions=!0,u._createNodeWidget(i,e),r=i.data(i.data("widgetName")));if(r===null)return;n.browser.safari||(h=u.element.children(".wijmo-wijtree-node").find("."+s.wijtreeInner+" .wijmo-wijtree-link"),h&&h.length>0&&h.removeClass("wijmo-wijtree-link"),p=u.element.children(".wijmo-wijtree-node").find("."+s.wijtreeInner+" .wijmo-checkbox"),p&&p.length>0&&p.removeClass("wijmo-checkbox")),o=u.getNodes(),(!t||t>o.length)&&t!==0&&(t=o.length),n.mobile&&r.element.find("a").addClass("ui-link"),a=r.getNodes(),r._tree=u._tree;for(f=0;f<a.length;f++)a[f]._tree=u._tree;r._setField("owner",u),c=o.length;if(!u.$nodes||!u.$nodes.length)u.$nodes=n("<ul></ul>").addClass("wijmo-wijtree-list").addClass(u.options.wijCSS.helperReset).addClass("wijmo-wijtree-child"),u.element.append(u.$nodes);c>0&&c!==t?r.element.get(0)!==o[t].element.get(0)&&r.element.insertBefore(o[t].element):u.$nodes.append(r.element),u.$subnodes=null,u._changeCollection(t,r),u._collectionChanged(),r._initNodeClass(),n.browser.safari||setTimeout(function(){h&&h.length>0&&h.addClass("wijmo-wijtree-link"),p&&p.length>0&&p.addClass("wijmo-checkbox")},0)},r.prototype.remove=function(e){var t=-1,n,r=this,i=this.getNodes();e.jquery?t=e.index():typeof e=="number"&&(t=e);if(t<0||t>=i.length)return;n=i[t],n.element.detach(),d(n.element),r.$subnodes=null,r._changeCollection(t),r._collectionChanged()},r.prototype.getNodes=function(){return this._hasChildren?this._createChildNodesPartially(!0):this._setField("nodes",[]),this._getField("nodes")},r.prototype._changeCollection=function(e,t){var n=this.getNodes(),r=this.options.nodes;t?(n.splice(e,0,t),r.splice(e,0,t.options)):(n.splice(e,1),r.splice(e,1))},r.prototype.sortNodes=function(){var e=this.getNodes();this._sort(),n.each(e,function(e,t){t._index=e,t._insertBefore(e)}),this._refreshNodesClass()},r.prototype.check=function(e){this._setOption("checked",e)},r.prototype.select=function(e){this._setOption("selected",e)},r.prototype.getOwner=function(){var e=this._getOwner();return e&&e.element.is("li")?e:null},r.prototype.expand=function(){this._setOption("expanded",!0)},r.prototype.collapse=function(){this._setOption("expanded",!1)},r.prototype._insertBefore=function(e){var t=this.element.parent().children("li");this.element.index()!==e&&this.element.insertBefore(t.eq(e))},r.prototype._sort=function(){var e=this.getNodes();this._isSorted?this._isDecsSort?(e.sort(this._compare2NodeTextDesc),this._isDecsSort=!1):(e.sort(this._compare2NodeTextAsc),this._isDecsSort=!0):(e.sort(this._compare2NodeTextAsc),this._isSorted=!0,this._isDecsSort=!0)},r.prototype._compare2NodeTextAsc=function(e,t){if(e!==null&&t!==null)return e._text.localeCompare(t._text)},r.prototype._compare2NodeTextDesc=function(e,t){if(e!==null&&t!==null)return-1*e._text.localeCompare(t._text)},r.prototype._collectionChanged=function(){this._hasChildren=this._hasSubNodes(),this._initNodeClass()},r.prototype._refreshNodesClass=function(){var e=this.getNodes(),t;for(t=0;t<e.length;t++)e[t]._initNodeClass()},r.prototype._setChecked=function(e){var t=this;if(t.options.checked===e&&t._checkState!=="indeterminate")return;t.options.checked=e,t.$nodeBody.attr("aria-checked",e),this._checkItem()},r.prototype._isClosestDisabled=function(){var e=this,t="."+e._tree.widgetFullName+"-disabled,."+e.widgetFullName+"-disabled";return e.element.closest(t,e._tree.element).length?!0:!1},r.prototype._setExpanded=function(e){var t=this,n=t.options;if(t._expanded===e)return;(t._hasChildren||n.hasChildren)&&t._expandNode(e)},r.prototype._setFocused=function(e){e?(this.$navigateUrl.focus(),this._setFocusNode()):this.$navigateUrl.trigger("focusout")},r.prototype._setFocusNode=function(){this._tree._focusNode&&n.browser.webkit&&this._tree._focusNode.$navigateUrl.trigger("focusout"),this._focused=!0,this._tree._focusNode=this,this.$inner.addClass(this.options.wijCSS.stateFocus)},r.prototype._setToolTip=function(e){e.length?this.element.attr("title",e):this.element.removeAttr("title")},r.prototype._setText=function(e){this._text!==e&&e.length&&(this._text=e,this._changeText(e))},r.prototype._setSelected=function(e){var t=this,n=t.options;n.selected!==e&&(n.selected=e,t.$nodeBody.attr("aria-selected",e),t._selectNode(e),t._setFocused(e))},r.prototype._setCheckBoxes=function(e){var t=this;t.$checkBox?t.$checkBox[e?"show":"hide"]():e&&t._createTreeCheck(),n.each(t.getNodes(),function(t,n){n._setCheckBoxes(e)})},r.prototype._setHitArea=function(e){var t=this;t._hasChildren&&(e?(t._initNodeClass(),t.$hitArea&&t.$hitArea.show()):(t._expanded=!0,t.options.expanded=!0,t.$nodeBody.attr("aria-expanded",!0),t.$nodes&&t.$nodes.length&&t.$nodes.show(),t._initNodeClass(),t.$hitArea&&t.$hitArea.hide())),n.each(t.getNodes(),function(t,n){n._setHitArea(e)})},r.prototype._getOwner=function(){return this._getField("owner")},r.prototype._getTree=function(){var e=this._getOwner();return e?e._tree?e._tree:e:null},r.prototype._getInitElement=function(){var e=n("<li>"),t=this,r=n("<ul>"),i=t.getNodes();return e.append(t.$navigateUrl.clone()),i.length&&(e.append(r),n.each(i,function(e,t){var n=t._getInitElement();r.append(n)})),e},r.prototype._updateSubNodes=function(){var e,t;this.$subnodes=[];if(this.$nodes===null||!this.$nodes.length)return;e=this.$nodes.children("li");for(t=0;t<e.length;t++)this.$subnodes.push(n(e[t]))},r.prototype._hasSubNodes=function(){return this.options.nodes&&this.options.nodes.length>0?!0:this._isHtmlGenerated()?!1:(this.$nodes===null&&(this.$nodes=this.element.children("ul").eq(0)),this.$nodes.length===0?!1:(this.$subnodes===null&&this._updateSubNodes(),this.$subnodes.length>0))},r.prototype._getNodeWidget=function(e){var t=this._getNodeByDom(e),n;return t.length>0?(n=t.data(t.data("widgetName")),n):null},r.prototype._createNodeWidget=function(e,t){return f(e,t,this,i,this.options.treeClass)},r.prototype._getNodeByDom=function(e){return n(e).closest(":"+this.widgetFullName)},r.prototype._getCurrentLevel=function(){return this.element.parentsUntil(":"+this.options.treeClass).length-1},r.prototype._getField=function(e){return this.element.data(e)},r.prototype._setField=function(e,t){this.element.data(e,t)},r.prototype._setAllowDrag=function(e){var t=this;e?t.$navigateUrl.one("mousedown."+t.widgetName,t,t._onMouseDown):t.element.data("ui-draggable")&&t.element.draggable("destroy")},r.prototype._isAllowDrag=function(){var e=this,t=e.options,n=e._tree.options;return t.allowDrag||n.allowDrag&&t.allowDrag!==!1?!0:!1},r.prototype._isAllowDrop=function(){var e=this,t=e.options,n=e._tree.options;return t.allowDrop||n.allowDrop&&t.allowDrop!==!1?!0:!1},r}(e.wijmoWidget);t.wijtreenode=m;var g=function(){function e(){this.wijCSS={wijtreeInner:""},this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body-b",stateDefault:"ui-btn ui-btn-b",stateHover:"ui-btn-down-c",stateActive:"ui-btn-down-b"},this.treeClass="wijmo-wijtree",this.initSelector=":jqmData(role='wijtreenode')",this.accessKey="",this.checked=!1,this.collapsedIconClass="",this.expanded=!1,this.expandedIconClass="",this.itemIconClass="",this.navigateUrl="",this.selected=!1,this.text="",this.toolTip="",this.hasChildren=!1,this.params={},this.nodes=null,this.allowDrag=null,this.allowDrop=null}return e}(),y=function(){function e(){this.wijMobileCSS={header:"ui-header ui-bar-a",content:"ui-body-b",stateDefault:"ui-btn ui-btn-b",stateHover:"ui-btn-down-b",stateActive:"ui-btn-down-c"},this.allowDrag=!1,this.allowDrop=!1,this.allowEdit=!1,this.allowSorting=!0,this.allowTriState=!0,this.autoCheckNodes=!0,this.autoCollapse=!1,this.disabled=!1,this.expandCollapseHoverUsed=!1,this.showCheckBoxes=!1,this.showExpandCollapse=!0,this.expandAnimation={effect:"blind",easing:"linear",duration:200},this.expandDelay=0,this.collapseAnimation={effect:"blind",easing:"linear",duration:200},this.collapseDelay=0,this.draggable=null,this.droppable=null,this.dropVisual=null,this.nodes=null,this.nodeBlur=null,this.nodeFocus=null,this.nodeClick=null,this.nodeCheckChanging=null,this.nodeCheckChanged=null,this.nodeCollapsed=null,this.nodeExpanded=null,this.nodeDragging=null,this.nodeDragStarted=null,this.nodeBeforeDropped=null,this.nodeDropped=null,this.nodeMouseOver=null,this.nodeMouseOut=null,this.nodeTextChanged=null,this.selectedNodeChanged=null,this.nodeExpanding=null,this.nodeCollapsing=null}return e}();m.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new g),v.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new y),n.wijmo.registerWidget("wijtree",v.prototype),n.wijmo.registerWidget("wijtreenode",m.prototype)})(e.tree||(e.tree={}));var t=e.tree})(wijmo||(wijmo={}));