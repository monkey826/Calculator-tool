var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},wijmo;(function(e){(function(t){var n=jQuery,r="wijmo-wijtilelist",i=n.extend(new e.wijmo_css,{tilelist:r,tilelistList:r+"-list",tilelistItem:r+"-item",tilelistItemStateDefault:"",tilelistLink:r+"-link",tilelistContent:r+"-content",tilelistIconContainer:r+"-iconcontainer"}),s=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._create=function(){var t=this;e.prototype._create.call(this),t._createTileList(),t._attachEvents()},t.prototype._setOption=function(t,n){if(t==="data"){this._setData(n);return}e.prototype._setOption.call(this,t,n)},t.prototype._createTile=function(e){var t=this,r=n("<li>"),i=n("<a>"),s=n("<img>"),o=n("<div>"),u=n.extend(!0,{},e),a=t.options.wijCSS,f,l=a.stateHover;return r.hover(function(){n(this).addClass(l)},function(){n(this).removeClass(l)}),t._onTileCreating({tile:u,element:r})===!1?r:(r.addClass(a.tilelistItem+" "+a.tilelistItemStateDefault).attr("title",u.hint),i.addClass(a.tilelistLink).attr("href","javascript:void(0)").appendTo(r),o.addClass(a.tilelistIconContainer).appendTo(i),(f=u.iconFormat)?s=f():s.attr("alt",u.text).attr("src",u.path).attr("align","bottom"),s.appendTo(o),n("<span>").addClass(a.tilelistContent).text(u.text).appendTo(i),t._onTileCreated({tile:e,element:r}),r)},t.prototype._createTiles=function(e){var t=this,r=n("<ul>");return r.addClass(t.options.wijCSS.tilelistList),e&&n.each(e,function(e,n){r.append(t._createTile(n))}),r},t.prototype._createTileList=function(){var e=this,t=e.options,n=t.wijCSS,r=e.element;r.addClass(n.widget+" "+n.tilelist),t.data&&t.data.length&&r.append(e._createTiles(t.data))},t.prototype._disposeTiles=function(e){e&&e.remove()},t.prototype._setData=function(e){var t=this,n=t.element.find("ul:first");t.options.data=e,t._$focusTile=null,n&&t._disposeTiles(n),n=t._createTiles(e),t.element.append(n)},t.prototype._setTileFocus=function(e){var t=this,n=t.options.wijCSS,r=n.stateFocus;t.element.find("li."+r).removeClass(r),e&&e.addClass(r).find("."+n.tilelistLink).focus(),t._$focusTile=e},t.prototype._attachEvents=function(){var e=this,t=e.widgetName;e.element.on("click."+t,n.proxy(e._handleClick,e)).on("keydown."+t,n.proxy(e._handleKeyDown,e))},t.prototype._handleClick=function(e){var t=this;t.selectTile(t._getTileElement(n(e.target)),e.ctrlKey)},t.prototype._handleKeyDown=function(e){var t=this,r=n.ui.keyCode;switch(e.keyCode){case r.LEFT:t._movePrev();break;case r.UP:t._moveUp();break;case r.RIGHT:t._moveNext();break;case r.DOWN:t._moveDown();break;default:return}e.preventDefault()},t.prototype._getTileElement=function(e){return e.closest("li."+this.options.wijCSS.tilelistItem)},t.prototype.selectTile=function(e,t){var r=this,i=r.element,s=r.options,o=s.wijCSS.stateHighlight,u=i.find("li").filter(function(){return n(this).hasClass(o)}),a;if(!e||!e.length)return;!s.allowMultipleSelection||!t?(u.removeClass(o),e.addClass(o)):e.toggleClass(o),a=i.find("li").filter(function(){return n(this).hasClass(o)}),u!==a&&r._onSelectionChanged({oldSelection:r._createSelectionArgs(u),newSelection:r._createSelectionArgs(a)}),r._setTileFocus(e)},t.prototype._createSelectionArgs=function(e){var t=this,r=t.options.data,i=[],s=t.element.find("li."+t.options.wijCSS.tilelistItem);return n.each(e,function(e,t){i.push({tile:r[s.index(t)],element:n(t)})}),i},t.prototype._getVSiblingTile=function(e,t){var n=this,r=n.element,i=n.options.wijCSS,s=r.find("li."+i.tilelistItem),o=r.find("ul."+i.tilelistList).width(),u,a,f,l;return!e||!o?null:(u=s.index(e),a=e.outerWidth(!0),f=Math.floor(o/a),l=u+(t?-1:1)*f,l<0||l>=Math.ceil(s.length/f)*f?e:(l>=s.length&&(l=s.length-1),s.eq(l)))},t.prototype._movePrev=function(){var e=this,t=e._$focusTile;e.selectTile(t&&t.prev())},t.prototype._moveNext=function(){var e=this,t=e._$focusTile;e.selectTile(t&&t.next())},t.prototype._moveUp=function(){var e=this,t=e._$focusTile,n=t&&e._getVSiblingTile(t,!0);if(n==t)return;e.selectTile(n)},t.prototype._moveDown=function(){var e=this,t=e._$focusTile,n=t&&e._getVSiblingTile(t,!1);if(n==t)return;e.selectTile(n)},t.prototype._onTileCreating=function(e){return this._trigger("tileCreating",null,e)},t.prototype._onTileCreated=function(e){return this._trigger("tileCreated",null,e)},t.prototype._onSelectionChanged=function(e){return this._trigger("selectionChanged",null,e)},t.prototype.setFocus=function(){var e=this,t=e._$focusTile;t&&t.length>0?e._setTileFocus(t):e.selectTile(e.element.find("li."+e.options.wijCSS.tilelistItem).first())},t}(e.wijmoWidget);t.wijtilelist=s;var o=function(){function e(){this.data=null,this.allowMultipleSelection=!1,this.tileCreating=undefined,this.tileCreated=undefined,this.selectionChanged=undefined,this.wijCSS=i}return e}();s.prototype.widgetEventPrefix="wijtilelist",s.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new o),n.wijmo.registerWidget("wijtilelist",s.prototype)})(e.tilelist||(e.tilelist={}));var t=e.tilelist})(wijmo||(wijmo={}));var wijmo;(function(e){(function(t){function A(e,t){if(e===t)return!0;if(e==null||t==null)return!1;if(e.length!=t.length)return!1;for(var r=0;r<e.length;++r)if(n.inArray(e[r],t)===-1)return!1;return!0}function O(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].path===t)return e[n];return null}function M(e){var t=D(e);return e[e.length-1]===t?e:e+t}function _(e){var t=D(e);return e[e.length-1]===t?e.substring(0,e.length-1):e}function D(e){return e&&e.indexOf(c)!==-1?c:h}function P(e){var t=[],n=0,r=e.length,i,s;e.sort(function(e,t){return e.path>t.path?1:e.path>t.path?-1:0});for(;n<r;n++){i=e[n];if(!i.isFolder){t.push(i);continue}s=!1;for(var o=0,u=t.length;o<u;o++){var a=t[o];if(!a.isFolder)continue;if(a.path.indexOf(i.path)>-1){s=!0;break}}s||t.push(i)}return t}function H(e,t){return t.indexOf(M(e))===0}function B(e,t){var n,r=D(e);return e=M(e),H(e,t)?(n=_(t.substring(e.length)),n.indexOf(r)===-1):!1}function j(e){return n(e).hasClass(u.folderItem)}function F(e){return e?e.replace(p,c):""}function I(e,t){var n=D(t);return t[0]!==l||t[1]!==n?F(t):(e==null&&(e=""),e.length>0&&(e=M(e)),F(e+t.substring(2)))}function q(e,t){var n,r=D(e),i=_(e).split(r).pop();return t?(n=q(e).indexOf("."),n===-1?i:i.substring(0,n)):i}function R(e){var t=q(e),n=q(e).indexOf(".");return n===-1?"":t.substring(n+1)}function U(e){var t=D(e);return e.substring(0,_(e).lastIndexOf(t))}function z(e){return n.map(e.split("-"),function(e,t){return e?(t===0?e.charAt(0).toLowerCase():e.charAt(0).toUpperCase())+e.substring(1):""}).join("")}function W(e){if(!e)return 0;var t=n(e);return t.length?t.outerWidth(!0)-t.width():0}var n=jQuery,r="wijmo-wijfileexplorer",i=".wijfileexplorer",s="wijfileexplorercommand",o="wijfileexplorerDragItems",u=n.extend(new e.wijmo_css,{fileExplorer:r,loadingOverlay:r+"-overlay",loadingText:r+"-loadingtext",itemsViewContainer:r+"-itemsviewcontainer",emptyFolderTip:r+"-emptyfoldertip",splitterV:"wijmo-wijsplitter-vertical",splitterVPanel1:"wijmo-wijsplitter-v-panel1",splitterVPanel2:"wijmo-wijsplitter-v-panel2",splitterVPanel1Content:"wijmo-wijsplitter-v-panel1-content",splitterVPanel2Content:"wijmo-wijsplitter-v-panel2-content",folderExpandedIcon:"ui-icon-folder-open",folderCollapsedIcon:"ui-icon-folder-collapsed",documentIcon:"ui-icon-document",folderItem:r+"-folder",fileItem:r+"-file",toolbar:r+"-toolbar",toolbarBack:r+"-back",toolbarForward:r+"-forward",toolbarOpen:r+"-open",toolbarRefresh:r+"-refresh",toolbarNewFolder:r+"-newfolder",toolbarDelete:r+"-delete",toolbarSetDetailViewMode:r+"-grid",toolbarSetThumbnailViewMode:r+"-thumbnail",toolbarUploader:r+"-uploader",address:r+"-address",addressPanel:r+"-addresspanel",addressBar:r+"-addressbar",filter:r+"-filter",filterPanel:r+"-filterpanel",addressBarFullWidth:r+"-addressbar-fullwidth",fileTree:r+"-filetree",tvLink:"wijmo-wijtree-link",gridContainer:r+"-gvContainer",listViewContainer:r+"-lvContainer",grid:r+"-gridview",sizeContent:r+"-sizecontent",gridRow:"wijmo-wijgrid-row",gridInnerCell:"wijmo-wijgrid-innercell",thumbnailView:r+"-listview",tileItem:"wijmo-wijtilelist-item",tileContent:"wijmo-wijtilelist-content",contentItem:r+"-content",contentItemContainer:r+"-contentcontainer",link:r+"-link",dragContent:r+"-dragcontent"}),a={detail:"detail",thumbnail:"thumbnail"},f={"default":"default",fileTree:"fileTree"},l="~",c="/",h="\\",p=/\\/g,d={toolbar:"toolbar",addressBox:"addressBox",filterBox:"filterTextBox",treeView:"treeView",detailView:"grid",thumbnailView:"listView",contextMenu:"contextMenu"},v={getHostUri:"GetHostUri",getItems:"GetItems",paste:"Paste",move:"Move","delete":"Delete",newFolder:"CreateDirectory",rename:"Rename"},m={name:"name",size:"size"},g=0,y=1,b={ascending:"ascending",descending:"descending"},w=300,E=500,S="",x=b.ascending,T=0,N=1,C=m.name,k=["*.*"],L={focusFileExplorer:"Ctrl+F2",focusTreeView:"Shift+3",focusToolBar:"Shift+1",focusGrid:"Shift+4",focusAddressBar:"Shift+2",popupWindowClose:"Esc",focusPager:"Shift+5",contextMenu:"Shift+M",back:"Ctrl+K",forward:"Ctrl+L",open:"Enter",refresh:"Ctrl+F3",newFolder:"Shift+N","delete":"Delete",uploadFile:"Ctrl+U"},X=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._create=function(){var t=this;e.prototype._create.call(this),t._initDataOptions(),t._initCommands(),t._createInnerControls(),t._optionsUpdated(),t._initMembers(),t._attachEvents()},t.prototype._getGlobalEventNameSpaceSuffix=function(){var e=this;return e._globalEventNameSpaceSuffix||(e._globalEventNameSpaceSuffix="."+e.element.uniqueId().attr("id"))},t.prototype._attachEvents=function(){var e=this,t=e._getGlobalEventNameSpaceSuffix();n(document).on("keydown"+t,function(t){if(e._contextMenu&&e._contextMenu.is(":visible"))return;if(t.keyCode===n.ui.keyCode.TAB){e._moveFocus(!t.shiftKey)&&t.preventDefault();return}if(t.keyCode===n.ui.keyCode.ENTER&&e._handleEnterKeyDown())return;return e._processShortcut(t)}).on("mousedown"+t,function(t){e._isChildElement(n(t.target))||e.element.find("."+e._focusCss).removeClass(e._focusCss)})},t.prototype._isChildElement=function(e){return e.closest("."+u.fileExplorer).length>0},t.prototype._handleEnterKeyDown=function(){var e=this,t;return t=e.element.find("li."+e._focusCss),t.parents("."+u.toolbar).length||t.parents("div.wijmo-wijpager").length>0?(t.find("a").click(),!0):!1},t.prototype._getCurrentFocusedItem=function(){var e=this,t=e.element.find("li."+e._focusCss).first();return!t.length||!t.parentsUntil("."+u.toolbar).length&&!t.parentsUntil(".wijmo-wijpager").length?null:t},t.prototype._getNextFocusableItem=function(e){var t=this,n=t._getCurrentFocusedItem();return n&&n.length?n[e?"next":"prev"]():null},t.prototype._moveFocus=function(e){var t=this,n=t._getNextFocusableItem(e);return n&&n.length?(t._setFocus(n,n,n.parent()),!0):!1},t.prototype._initMembers=function(){var e=this,t=e.options.wijCSS;e._focusCss=t.stateFocus,e._activeCss=t.stateActive},t.prototype._optionsUpdated=function(){var e=this;e._layoutOptionsUpdated(),e._enableOpenFileUpdated(),e._enableCreateNewFolderUpdated(),e._enableCopyUpdated(),e._allowMultipleSelectionUpdated(),e._disabledUpdated(),e._createRootNodes(),e._executeWithHostUri(),e._loadCurrentFolder()},t.prototype._loadCurrentFolder=function(){var e=this,t=e._showingControls[d.detailView]||e._showingControls[d.thumbnailView];if(t&&!e._data()){e._openFolder(e._createCurrentStateRequest(),function(){return e._expand(e._getNodeByPath(e.options.currentFolder))});return}e._currentFolderUpdated(),e._expand(e._getNodeByPath(e.options.currentFolder))},t.prototype._createRootNodes=function(){var e=this,t=e._getTreeInitData();e._updateTreeViewData(null,t)},t.prototype._getTreeInitData=function(){var e=this;return e._enableAjax()?n.map(e._getRootPaths(),function(e){return{path:e,isFolder:!0,hasSubFolders:!0,hasChildren:!0}}):e._data()},t.prototype._selectCurrentFolderTreeNode=function(){this._selectTreeNode(this.options.currentFolder)},t.prototype._selectTreeNode=function(e){var t=this,n=t._getNodeByPath(e);if(!n)return;t._setSelection({path:n.options.value,isFolder:j(n.element),hasChildren:n.options.hasChildren,operatingArea:0}),n.options.selected||n.select(!0)},t.prototype.destroy=function(){var t=this,r=t.options.wijCSS,s=t._getGlobalEventNameSpaceSuffix();t._filterTimer&&(clearTimeout(t._filterTimer),t._filterTimer=null),t._showLoadingLayerTimer&&(clearTimeout(t._showLoadingLayerTimer),t._showLoadingLayerTimer=null),t._contextMenu&&t._contextMenu.data("wijmo-wijmenu")&&t._contextMenu.wijmenu("destroy"),t._dialog&&t._dialog.data("wijmo-wijdialog")&&t._dialog.wijdialog("destroy"),t._treeView&&t._treeView.data("wijmo-wijtree")&&t._treeView.wijtree("destroy"),t._pager&&t._pager.data("wijmo-wijpager")&&t._pager.wijpager("destroy"),t._detailView&&t._detailView.data("wijmo-wijgrid")&&t._detailView.wijgrid("destroy"),t._thumbnailView&&t._thumbnailView.data("wijmo-wijtilelist")&&t._thumbnailView.wijtilelist("destroy"),t._splitter&&t._splitter.data("wijmo-wijsplitter")&&t._splitter.wijsplitter("destroy"),n(document).off(s),n(window).off(s),t.element.removeClass(r.widget+" "+u.fileExplorer+" "+r.helperReset).attr("tabindex","").off(i).empty().removeUniqueId(),e.prototype.destroy.call(this)},t.prototype._initCommands=function(){var e=this;e._commands={open:new $("open",function(){return e._open()},e.localizeString("commandOpen","Open")),"delete":new $("delete",function(){return e._delete()},e.localizeString("commandDelete","Delete")),refresh:new $("refresh",function(){return e.refresh()},e.localizeString("commandRefresh","Refresh")),rename:new $("rename",function(){return e._rename()},e.localizeString("commandRename","Rename")),newFolder:new $("newFolder",function(){return e._newFolder()},e.localizeString("commandNewFolder","New Folder")),copy:new $("copy",function(){return e._copy()},e.localizeString("commandCopy","Copy")),paste:new $("paste",function(){return e._paste()},e.localizeString("commandPaste","Paste")),back:new $("back",function(){return e._back()},e.localizeString("commandBack","Back")),forward:new $("forward",function(){return e._forward()},e.localizeString("commandForward","Forward")),setDetailViewMode:new $("setDetailViewMode",function(){return e._setOption("viewMode",a.detail)},e.localizeString("commandSetDetailViewMode","Detail View Mode")),setThumbnailViewMode:new $("setThumbnailViewMode",function(){return e._setOption("viewMode",a.thumbnail)},e.localizeString("commandSetThumbnailViewMode","Thumbnail View Mode")),focusFileExplorer:new $("focusFileExplorer",function(){return e._focusFileExplorer()}),focusToolBar:new $("focusToolBar",function(){return e._focusToolBar()}),focusTreeView:new $("focusTreeView",function(){return e._focusTreeView()}),focusGrid:new $("focusGrid",function(){return e._focusGrid()}),focusPager:new $("focusPager",function(){return e._focusPager()}),focusAddressBar:new $("focusAddressBar",function(){return e._focusAddressBar()}),popupWindowClose:new $("popupWindowClose",function(){return e._popupWindowClose()}),contextMenu:new $("contextMenu",function(){return e._openContextMenu()})}},t.prototype._createInnerControls=function(){var e=this,t=e.options.wijCSS;e._showingControls={},e.element.addClass(t.widget+" "+u.fileExplorer+" "+t.helperReset).attr("tabindex","-1"),e._createToolbar(),e._createAddressBar(),e._createSplitter(),e._createDialog(),e._createContextMenu()},t.prototype._setDialogButtons=function(e){var t=this,r=null;e&&(r=[{text:t.localizeString("dialogOK","OK"),click:function(){t._dialogOk&&t._dialogOk(t._dialogInput.val()),n(this).wijdialog("close")}},{text:t.localizeString("dialogCancel","Cancel"),click:function(){n(this).wijdialog("close")}}]),t._dialog.wijdialog({buttons:r})},t.prototype._createDialog=function(){var e=this,t=e.element;e._dialog=n("<div>").css("overflow","hidden").appendTo(t),e._dialog.wijdialog({autoOpen:!1,modal:!0,resizable:!0,buttons:{Ok:function(){e._dialogOk&&e._dialogOk(e._dialogInput.val()),n(this).wijdialog("close")},Cancel:function(){n(this).wijdialog("close")}},captionButtons:{pin:{visible:!1},refresh:{visible:!1},toggle:{visible:!1},minimize:{visible:!1},maximize:{visible:!1}}}),e._dialogInput=n('<input aria-label="input">').css("width","100%").hide().appendTo(e._dialog),e._dialog.on("keydown"+i,function(t){t.keyCode===n.ui.keyCode.ENTER&&(e._dialogOk&&e._dialogOk(e._dialogInput.val()),e._dialog.wijdialog("close"),t.stopPropagation())}),e._dialogContent=n("<div>").css("width","100%").css("height","100%").css("overflow","hidden").appendTo(e._dialog)},t.prototype._createContextMenu=function(){var e=this,t=e.options,r=e.element,o=e._commands,a=n("<ul>").attr("tabindex","-1").appendTo(r),f=[o.open,o.newFolder,o.copy,o.paste,o["delete"],o.rename],l,c=e._getGlobalEventNameSpaceSuffix(),h;n.each(f,function(e,t){l=n("<li>").data(s,t).append(n("<a>").attr("href","#").text(t.text)).appendTo(a),t.addBindElement(l)}),a.wijmenu({orientation:"vertical",trigger:r,disabled:t.disabled,triggerEvent:"rtclick",animation:{easing:"easeOutCubic"},showing:function(t,n){if(!e._isActived()||e._isLoading()||!e._showingControls[d.contextMenu])return e._setContextItem(null),!1;e._contextMenu.wijmenu("deactivate");var r=t.which===3||!t.originalEvent?t:t.originalEvent.target;n.options.position={my:"left2 top2",at:"left center",of:r,collision:"fit"}},shown:function(){return e._focusContextMenu()},hidden:function(){e._setContextItem(null)},select:function(e,n){h=n.item.element.data(s),a.find("."+u.stateFocus).removeClass(t.wijCSS.stateFocus).removeClass(t.wijCSS.stateHover),h&&h.execute()}}).on("mousedown"+i,function(e){e.stopPropagation()}).on("keydown"+i,function(t){t.keyCode===n.ui.keyCode.ESCAPE&&e._hideContextItem()}),e._contextMenu=a,n(document).on("contextmenu"+c,function(t){e._hideContextItem()}).on("mousedown"+c,function(t){if(t.which===3)return;e._hideContextItem()}),e.element.on("contextmenu"+i,function(t){if(!e._isActived())return;var r=t.target,i=r&&e._getItemFromElement(r);e._setContextItem(null);if(!r||i==null)return;if(i.operatingArea===0||e._isSelected(i)){e._setContextItem(i);return}t.ctrlKey||(e._selectItemsViewItem(n(r)),e._setContextItem(i))})},t.prototype._focusContextMenu=function(){var e=this,t=e._contextMenu;if(!t||!t.length)return;t.focus()},t.prototype._hideContextItem=function(){var e=this;e._contextMenu&&(e._contextMenu.wijmenu("hideAllMenus"),e._setContextItem(null))},t.prototype._selectItemsViewItem=function(e){var t=this;if(t._showingControls[d.detailView]){t._selectDetailViewItem(e);return}t._showingControls[d.thumbnailView]&&t._selectThumbnailViewItem(e)},t.prototype._selectThumbnailViewItem=function(e){this._thumbnailView.wijtilelist("selectTile",e.closest("li"))},t.prototype._selectDetailViewItem=function(e){if(!e||e.length===0)return;var t=this,n=t._detailView,r=n.wijgrid("selection"),i=n.wijgrid("getCellInfo",e[0]);if(!r||!i)return;t._selectionUpdating=!0,r.clear(),t._selectionUpdating=!1,r.addRows(i.rowIndex())},t.prototype._showDialog=function(e,t,n,r,i,s){typeof s=="undefined"&&(s=!0);var o=this,u={title:e,resizable:n,width:r,height:i};s||o._setDialogButtons(!1),o._dialogContent.empty().append(t).show(),o._dialogInput.hide(),o._dialog.wijdialog(u).wijdialog("open"),o._dialogOk=null},t.prototype._showInputDialog=function(e,t,n){var r=this,i,s,o;r._setDialogButtons(!0),r._dialogContent.hide(),r._dialogInput.val(t).show(),r._dialog.wijdialog({title:e,resizable:!1,width:"300",height:"200"}).wijdialog("open"),i=r._dialogInput[0],s=i.value.length,s>0&&(i.setSelectionRange?i.setSelectionRange(0,s):i.createTextRange&&(o=i.createTextRange(),o.collapse(!0),o.moveStart("character",0),o.moveEnd("character",s),o.select())),r._dialogOk=n},t.prototype._showConfirmDialog=function(e,t,n){var r=this;r._setDialogButtons(!0),r._dialogContent.empty().append(t).show(),r._dialogInput.hide(),r._dialog.wijdialog({title:e,resizable:!1,width:"300",height:"200"}).wijdialog("open"),r._dialogOk=n},t.prototype._hideDialog=function(){this._dialog.wijdialog("close")},t.prototype._isVisibleControl=function(e){var t=this.options.visibleControls;return!t||t.indexOf(e)>-1},t.prototype._createToolbar=function(){var e=this,t=e.options,r=t.wijCSS,o=e._commands,a=[o.back,o.forward,o.open,o.refresh,o.newFolder,o["delete"],o.setDetailViewMode,o.setThumbnailViewMode],f=n("<div>").attr("tabindex","-1").addClass(r.helperReset).appendTo(e.element),l=n("<ul>").addClass(r.widget).addClass(r.helperReset).addClass(r.helperClearFix).addClass(r.stateDefault).addClass(u.toolbar).appendTo(f);e._toolbar=l,n.each(a,function(e,t){var i=n("<span>").addClass(r.icon),o=n("<a>").attr("herf","#").addClass(u.link).append(i),a=n("<li>").data(s,t).attr("title",t.text).addClass(u[z("toolbar-"+t.name)]).addClass(r.stateDefault).addClass(r.cornerAll).append(o).appendTo(l);t.addBindElement(a)}),l.on("click"+i,function(t){if(!e._isActived())return;var r=n(t.target).closest("li").data(s);r&&r.execute()}).on("mouseenter"+i,"li",function(){!t.disabled&&!n(this).hasClass(r.stateDisabled)&&n(this).addClass(r.stateHover)}).on("mouseleave"+i,"li",function(){n(this).removeClass(r.stateHover)}),e._showingControls[d.toolbar]=!0},t.prototype._createAddressBar=function(){var e=this,t=e.options.wijCSS,r=n("<div>").addClass(u.addressBar).addClass(t.helperClearFix).addClass(t.content).appendTo(e.element);e._createAddressBox(r),e._createFilterBox(r)},t.prototype._createAddressBox=function(e){var t=this,r=n("<div>").addClass(u.addressPanel).appendTo(e);t._addressBox=n("<div>").addClass(u.address).addClass(t.options.wijCSS.content).appendTo(r),t._showingControls[d.addressBox]=!0},t.prototype._createFilterBox=function(e){var t=this,r=t.options,s=n("<div>").addClass(u.filterPanel).appendTo(e),o=n("<input type='text' aria-label='filterBox' />"),a=function(){t._filterTimer!=undefined&&(clearTimeout(t._filterTimer),t._filterTimer=null)},f="input"+i+" propertychange"+i+" keyup"+i,l=t._filterExpression()||S;t._filterBox=o.addClass(u.filter).addClass(r.wijCSS.content).appendTo(s).on("keydown"+i,function(e){e.stopPropagation(),e.keyCode===n.ui.keyCode.ENTER&&(r.enableFilteringOnEnterPressed&&t._filter(o.val()),e.preventDefault())}).on(f,function(e){if(r.enableFilteringOnEnterPressed)return;if(e.type==="propertychange"&&e.originalEvent.propertyName!=="value")return;a(),t._filterTimer=setTimeout(function(){t._filter(o.val()),a()},w)}).on("focus"+i,function(){t._restoreFocus=function(){o&&o.focus()}}),t._showingControls[d.filterBox]=!0,l!==o.val()&&o.val(l)},t.prototype._createSplitter=function(){var e=this,t=n("<div>"),r=n("<div>"),i=n("<div style='height:100%;'>"),s=function(){e._adjustDetailViewWidth(),e.options.treePanelWidth=i.wijsplitter("option","splitterDistance")};e._splitter=i.append(t).append(r).appendTo(e.element).wijsplitter({orientation:"vertical",sized:s,collapsed:s,expanded:s,fullSplit:!0}),e._createTreeView(t),e._createItemsView(r)},t.prototype._createTreeView=function(e){var t=this,r;t._treeView=n("<ul>").appendTo(e).wijtree({selectedNodeChanged:function(e,n){r=t._getItemFromElement(n.element);if(t._sameWithSelection(r))return;t.options.viewMode==="detail"&&t._detailView.wijgrid("selection").clear(),t._setSelection(r);if(t.options.mode===f["default"]){t._open();return}r.isFolder&&t._setCurrentFolder(r.path)}}),t._treeView.parent().addClass(u.fileTree),t._attachTreeViewEvents(),t._showingControls[d.treeView]=!0},t.prototype._attachTreeViewEvents=function(){var e=this,t=e.options,r=".wijmo-wijtree-parent";e._treeView.on("click"+i,r,function(t){if(!e._isActived())return;if(n(t.target).is("."+u.icon)){var r=n(this).data("wijmo-wijtreenode");r&&(!r.$nodes||!r.$nodes.length)&&(r.options.expanded||e._expandWithNewNodes(r.options.value))}}).on("dblclick"+i,r,function(r){if(!e._isActived())return;var i=n(this).data("wijmo-wijtreenode"),s=function(){return i.select(!0)},o=n(r.target).parents(".wijmo-wijtree-item."+u.folderItem);if(o.length||!i){o.length&&(i=o.data("wijmo-wijtreenode"),s());return}t.mode===f["default"]?i.options.expanded?(i.collapse(),s()):e._expand(i,s):e._open(s),r.stopPropagation()}).on("keydown"+i,function(r){if(t.disabled)return;if(r.keyCode===n.ui.keyCode.RIGHT){e._onTreeViewRightKeyDown();return}if(r.keyCode===n.ui.keyCode.ENTER){r.stopPropagation();return}if(r.keyCode===n.ui.keyCode.TAB&&!r.shiftKey){e._focusGrid(),r.preventDefault(),r.stopPropagation();return}return e._processShortcut(r)}),e._treeView.parents("."+u.fileTree).first().parent().on("mouseup"+i,function(){if(t.disabled)return;e._focusTreeView()})},t.prototype._initNodeHasChildren=function(e,t){e._setOption("hasChildren",t),e._initNodeClass&&e._initNodeClass(),!t&&e.options.expanded&&e.collapse()},t.prototype._setTreeViewNodes=function(e,t){var r=this,i=r.options,s=i.mode===f.fileTree,o=t.options.nodes.length;if(!e)return;r._initNodeHasChildren(t,!!e.length);while(o>0)t.remove(o-1),o--;n.each(e,function(e,i){if(!s&&!i.isFolder)return;var o={text:q(i.path),value:i.path,hasChildren:undefined,expandedIconClass:undefined,collapsedIconClass:undefined,itemIconClass:undefined,nodes:[]};i.isFolder?(o.hasChildren=(s?i.hasChildren:i.hasSubFolders)||!1,o.expandedIconClass=u.folderExpandedIcon,o.collapsedIconClass=u.folderCollapsedIcon):(o.hasChildren=!1,o.itemIconClass=u.documentIcon),t.add(o),t.element.find("li:last").addClass(i.isFolder?u.folderItem:u.fileItem);if(o.hasChildren){var a=t.getNodes(),f=n(a).filter(function(){return this.options.value==o.value});f.length>0&&r._setTreeViewNodes(i.children,f[0])}})},t.prototype._createItemsView=function(e){var t=this,r=n("<div>").addClass(u.itemsViewContainer).appendTo(e);t._itemsViewContainer=r,t._createDetailView(r),t._createThumbnailView(r),t._createEmptyFolderTip(r),t._createPager(e),t._attachItemsViewContainerEvents()},t.prototype._attachItemsViewContainerEvents=function(){var e=this,t=e.options;e._itemsViewContainer.on("click"+i,function(){if(t.disabled)return;e._focusGrid()}).on("keydown"+i,function(r){if(t.disabled)return;if(r.keyCode===n.ui.keyCode.TAB&&r.shiftKey){e._focusTreeView(),r.preventDefault(),r.stopPropagation();return}})},t.prototype._createEmptyFolderTip=function(e){var t=this,r=n("<div>").text(t.localizeString("emptyFolder","This folder is empty.")).addClass(u.emptyFolderTip).appendTo(e).hide();t._emptyFolderTip=r},t.prototype._createPager=function(e){var t=this,r=t.options.wijCSS,i=n("<div>").wijpager({mode:"numeric",pageIndexChanged:function(e,n){t._page(n.newPageIndex)}}).addClass(r.stateDefault).addClass(r.widget).addClass("wijmo-wijpager ui-helper-clearfix").appendTo(e);t._pager=i},t.prototype._adjustDetailViewWidth=function(){var e=this,t=e._detailView,n,r,i;if(!t||!t.length)return;e._cancelDetailViewSelectionChange=!e._getDetailViewSelectedCells().length(),r=e._getDetailViewMinWidth(),n=e._itemsViewContainer.scrollLeft(),i=t.parent(),i.css("width",""),r>i.width()&&i.width(t.outerWidth(!0)),e._detailView.wijgrid("doRefresh"),e._itemsViewContainer.scrollLeft(n),e._cancelDetailViewSelectionChange=!1},t.prototype._getDetailViewMinWidth=function(){var e=this,t=e._detailView.wijgrid("option","columns")[0].width||e._getNameColumnMinWidth();return t+e._getSizeColumnMinWidth()+e._getDetailViewOuterAreaWidth()},t.prototype._getDetailViewOuterAreaWidth=function(){var e=this;return e._detailViewOuterAreaWidth===undefined&&(e._detailViewOuterAreaWidth=W(e._detailView)),e._detailViewOuterAreaWidth},t.prototype._getSizeColumnMinWidth=function(){var e=this;return e._sizeColumnMinWidth===undefined&&(e._sizeColumnMinWidth=e._getColumnMinWidth(y,"."+u.sizeContent)),e._sizeColumnMinWidth},t.prototype._getNameColumnMinWidth=function(){var e=this;return e._nameColumnMinWidth===undefined&&(e._nameColumnMinWidth=e._getColumnMinWidth(g,"tbody>tr>td ."+u.contentItem)),e._nameColumnMinWidth},t.prototype._getColumnMinWidth=function(e,t){var r=this,i=r._detailView,s=i.find("th>."+u.gridInnerCell).eq(e),o=s.css("display"),a,f,l;return s.css("display","inline-block"),l=s.outerWidth(!0)+W(s.closest("th")),s.css("display",o),i.find(t).each(function(e,t){a=n(t),f===undefined&&(f=W(a.closest("td"))+W(a.closest("."+u.gridInnerCell))),l=Math.max(l,a.outerWidth(!0)+f)}),l},t.prototype._createDetailView=function(e){var t=this,r=t.options,i=r.wijCSS,s=function(e,r){var s=e.find(".wijmo-wijgrid-sort-icon");if(t._sortExpression()===r){if(!s||!s.length)s=n("<span>").addClass("wijmo-wijgrid-sort-icon  ui-icon").css("cursor","pointer").appendTo(e);t._sortDirection()===b.descending?(s.removeClass(i.iconArrowUp),s.addClass(i.iconArrowDown)):(s.removeClass(i.iconArrowDown),s.addClass(i.iconArrowUp))}else s.remove()},o=n("<table>").appendTo(e).wijgrid({rendered:function(){t._updatingDetailViewData&&(t._sizeColumnMinWidth=undefined,t._nameColumnMinWidth=undefined,t._detailViewOuterAreaWidth=undefined);var e=n(this).find("th .wijmo-wijgrid-innercell");s(e.eq(0),m.name),s(e.eq(1),m.size)},sorting:function(e,n){var r=n.column.dataKey===m.size?m.size:m.name,i=t._sortDirection()===b.descending?b.ascending:b.descending;return t._sort(r,i),!1},columnsAutogenerationMode:"none",allowSorting:!0,allowColSizing:!0,columnResized:function(){t._adjustDetailViewWidth()},columns:[{dataKey:"path",dataType:"string",headerText:t.localizeString("detailViewColumnNameTitle","Name"),cellFormatter:function(e){var t=e.row.data;if(t&&t.path&&e.row.type&n.wijmo.wijgrid.rowType.data){var i=r.wijCSS.icon,s=n("<span>"),o=n("<span>");return s.addClass(u.contentItem).text(q(t.path)),t.isFolder?(o.addClass(i+" "+u.folderCollapsedIcon),n(e.row.$rows).addClass(u.folderItem)):(o.addClass(i+" "+u.documentIcon),n(e.row.$rows).addClass(u.fileItem)),e.$container.empty().append(o).append(s).addClass(u.contentItemContainer),!0}}},{allowSizing:!1,dataKey:"size",dataType:"number",headerText:t.localizeString("detailViewColumnSizeTitle","Size"),cellFormatter:function(e){if(e.row.type&n.wijmo.wijgrid.rowType.data){var r=e.row.data.size,i="",s=e.$container;s.empty();if(r!=null){var o=r/1e3;i=Globalize.format(o,"n")+" "+t.localizeString("detailViewColumnSizeUnit","KB"),s.append(n("<span>").addClass(u.contentItemContainer).addClass(u.sizeContent).text(i))}return!0}}}]});t._detailView=o,t._attachDetailViewEvent(),t._showingControls[d.detailView]=!0},t.prototype._attachDetailViewEvent=function(){var e=this,t="."+u.gridRow,r="wijgrid";e._detailView.on(r+"currentcellchanging",function(){return!e._cancelDetailViewSelectionChange&&!e._updatingDetailViewData}),e.element.on("dblclick"+i,t,function(){e._open()}).on(r+"selectionchanged"+i,function(){e._onDetailViewSelectionChanged(),e._setItemsViewDrag(e._detailView)}),n(window).on("resize"+e._getGlobalEventNameSpaceSuffix(),function(){e._adjustDetailViewWidth()})},t.prototype._createThumbnailView=function(e){var t=this,r=t.options,i=r.wijCSS;t._thumbnailView=n("<div>").addClass(u.thumbnailView).appendTo(e).wijtilelist({allowMultipleSelection:r.allowMultipleSelection,tileCreating:function(e,t){var s=t.tile,o=t.element;s.text=q(s.path),s.hint=s.text,s.isFolder?(s.iconFormat=function(){return n("<span>").attr("alt",s.text).addClass(i.icon).addClass(u.folderCollapsedIcon)},o.addClass(u.folderItem)):(s.path=I(r.hostUri,s.path),o.addClass(u.fileItem))},selectionChanged:function(e,r){var i=[];n.each(r&&r.newSelection,function(e,t){i.push({path:t.tile.path,isFolder:t.tile.isFolder,operatingArea:1})}),t._setSelection(i),t._setItemsViewDrag(t._thumbnailView)}}).hide(),t._attachThumbnailViewEvent(),t._showingControls[d.thumbnailView]=!1},t.prototype._attachThumbnailViewEvent=function(){var e=this;e.element.on("dblclick"+i,"."+u.tileItem,function(){e._open()})},t.prototype._back=function(){this._moveHistory(-1)},t.prototype._moveHistory=function(e){var t=this;if(!t._isActived()||!e||!t._canBack()&&e<0||!t._canForward()&&e>0)return;t._updatingHistoryStep=e,t._openFolder(t._histories[t._currentHistoryIndex+e])},t.prototype._forward=function(){this._moveHistory(1)},t.prototype._expand=function(e,t){var n=this;if(!e){t&&t();return}e.$nodes&&e.$nodes.length?(n._expandWithExistedNodes(e),t&&t()):n._expandWithNewNodes(e.options.value,t)},t.prototype._open=function(e){var t=this;if(!t._isActived())return;var n=t._getOperatingItem();if(n.isFolder){if(n.path===t.options.currentFolder){t._expand(t._getNodeByPath(n.path),e);return}t._openFolder(n.path,function(){t._updateHistory(),e&&e()});return}t._openFile(n.path)},t.prototype._openFile=function(e){var t=this,r=q(e),i,s;if(t.options.enableOpenFile){if(t._triggerFileOpening({path:e})===!1)return;t._executeWithHostUri(function(){i=I(t.options.hostUri,e),s=n("<iframe src='"+i+"' style='border:none; width:100%; height:100%' frameborder='no'></iframe>"),t._showDialog(t.localizeString("openFileDialogTitle","View file: ")+r,s,!0,"480","480",!1),t._triggerFileOpened({path:e})})}},t.prototype._executeWithHostUri=function(e){var t=this;if(t.options.hostUri!=null){e&&e();return}t._getHostUriCall(e)},t.prototype._getHostUriCall=function(e){var t=this;t._tryAjax(v.getHostUri,null,null,function(n){t._setOption("hostUri",n.hostUri||""),e&&e()})},t.prototype._sortDirection=function(e){if(e===undefined)return this._sortDirectionValue||x;this._sortDirectionValue=e},t.prototype._sortExpression=function(e){if(e===undefined)return this._sortExpressionValue||C;this._sortExpressionValue=e},t.prototype._filterExpression=function(e){if(e===undefined)return this._filterExpressionValue||S;this._filterExpressionValue=e},t.prototype._pageCount=function(e){if(e===undefined)return this._pageCountValue||N;this._pageCountValue=e},t.prototype._pageIndex=function(e){if(e===undefined)return this._pageIndexValue||T;this._pageIndexValue=e},t.prototype._data=function(e){var t=this;if(e===undefined)return t._dataValue;t._dataValue=e,t._enableAjax()||(t._resolveData(),t._sortData())},t.prototype._removeDefaultInRequest=function(e){var t=n.extend({},e);return(!t.filterExpression||t.filterExpression===S)&&delete t.filterExpression,(!t.sortExpression||t.sortExpression===C)&&delete t.sortExpression,!t.sortDirection&&t.sortDirection===x&&delete t.sortDirection,!t.pageIndex&&t.pageIndex===T&&delete t.pageIndex,t},t.prototype._createDefaultRequest=function(e){var t=this,n=t.options,r={path:e||t.options.currentFolder,filterExpression:S,sortExpression:C,sortDirection:x};return n.allowPaging&&(r.pageIndex=T,r.pageSize=n.pageSize),r},t.prototype._createCurrentStateRequest=function(e){var t=this,n=t.options,r={path:e||t.options.currentFolder,filterExpression:t._filterExpression(),sortExpression:t._sortExpression(),sortDirection:t._sortDirection()};return n.allowPaging&&(r.pageIndex=t._pageIndex(),r.pageSize=n.pageSize),r},t.prototype._applyRequestData=function(e,t){var n=this,r=n.options;e.filterExpression!=null&&n._filterExpression(e.filterExpression),r.allowPaging&&(t&&t.pageIndex?n._pageIndex(t.pageIndex):n._pageIndex(T),t&&t.pageCount?n._pageCount(t.pageCount):n._pageCount(N)),e.sortExpression!=null&&n._sortExpression(e.sortExpression),e.sortDirection!=null&&n._sortDirection(e.sortDirection)},t.prototype._updateItemsViewCall=function(e,t,r){var i=this,s=n.extend(i._createCurrentStateRequest(),e);i._getItemsCall(s,function(e){i._data(e.itemOperationResults),i._applyRequestData(s,e),i._updateItemsView(t),i._triggerFolderLoaded({currentFolder:i.options.currentFolder}),i._selectCurrentFolderTreeNode(),r&&r()})},t.prototype._openFolder=function(e,t,r){typeof e=="string"&&(e={path:e});var i=this,s=n.extend({},i._createDefaultRequest(),e);i._getItemsCall(s,function(e){i._data(e.itemOperationResults),i._applyRequestData(s,e),i._setCurrentFolder(s.path),t&&t()},r)},t.prototype._isDefaultSearchPattern=function(){return A(this.options.searchPatterns,this._getDefaultSearchPattern())},t.prototype._getDefaultSearchPattern=function(){return k},t.prototype._getItemsCall=function(e,t,r){var i=this,s=i.options;e=n.isPlainObject(e)?e:{path:e};if(e.path==null)return;!e.onlyFolder&&s.searchPatterns!=null&&!i._isDefaultSearchPattern()&&(e.searchPatterns=s.searchPatterns),e=i._removeDefaultInRequest(e),i._tryAjax(v.getItems,e,null,function(e){t&&t(e)},function(){return r&&r(),!1},function(){t&&t({itemsOperationResults:i._data()})})},t.prototype.refresh=function(e){var t=this;if(e&&e!==t.options.currentFolder){t._getNodeByPath(e)&&t._refreshTreeNode(e);return}t._openFolder(t._createCurrentStateRequest()),t._refreshTreeNode(t.options.currentFolder,function(){return t._selectCurrentFolderTreeNode()})},t.prototype._newFolder=function(){var e=this,t=e._getOperatingItem(),n=t&&t.operatingArea===0?t.path:e.options.currentFolder;e.options.enableCreateNewFolder&&e._showInputDialog(e.localizeString("newFolderDialogTitle","Enter new folder name"),e.localizeString("defaultNewFolderName","New Folder"),function(t){t&&e._newFolderCall(t,n)})},t.prototype._newFolderCall=function(e,t){var n=this,r=M(t)+e;if(n._triggerNewFolderCreating({path:r})===!1)return;n._tryAjax(v.newFolder,{path:r},null,function(){n._triggerNewFolderCreated({path:r}),n._refreshAfterAdd(t)},null,function(){n._addItemsInData({path:r,isFolder:!0,hasChildren:!1,hasSubFolder:!1,children:[]},n._getFolderData(t)),n.refresh(t)})},t.prototype._refreshTreeNode=function(e,t){var n=this;n._getItemsCall({path:e,onlyFolder:n.options.mode===f["default"]},function(r){n._updateTreeViewData(e,r.itemOperationResults),t&&t()})},t.prototype._delete=function(){var e=this;if(!e._isActived())return;var t=P(e._getOperatingItems());if(e._hasRootPath(t))return;t&&t.length&&e._showConfirmDialog(e.localizeString("deleteDialogTitle","Warning"),e.localizeString("deleteDialogAlertingText","Are you sure to delete the selected item? This operation cannot be undone."),function(){e._deleteCall(t)})},t.prototype._deleteCall=function(e){if(!e||!e.length)return;var t=this,r=[];n.each(e,function(e,n){if(t._triggerItemDeleting({path:n.path})===!1)return;r.push(n.path)}),t._tryAjax(v["delete"],{sourcePaths:r},null,function(r){if(!r.itemOperationResults||!r.itemOperationResults.length)return;var i=[];n.each(r.itemOperationResults,function(n,r){if(!r)return;if(r.success){i.push(O(e,r.path)),t._triggerItemDeleted({path:r.path});return}t._processError(r.error)}),t._refreshAfterDelete(i)},function(){t._refreshAfterDelete(e)},function(){t._removeItemsInData(e),t.refresh()})},t.prototype._rename=function(){var e=this,t=e._getOperatingItem(),n=e.options.allowFileExtensionRename;if(t){if(e._isRootPath(t.path))return;var r=q(t.path,!n&&!t.isFolder),i=n||t.isFolder?"":"."+R(t.path);e._showInputDialog(e.localizeString("renameDialogTitle","Enter new name"),r,function(n){if(n&&n!==r){if(e._triggerItemRenaming({path:t.path,newName:n})===!1)return;e._renameCall(t,n+i)}})}},t.prototype._renameCall=function(e,t){var r=this,i=U(e.path),s=M(i)+t;r._tryAjax(v.rename,{path:s,sourcePaths:[e.path]},null,function(){r._refreshAfterRename(e.path,M(i)+t),r._triggerItemRenamed({path:e.path,newName:q(t,!r.options.allowFileExtensionRename)})},null,function(){r._removeItemsInData(e,!0),r._addItemsInData(n.extend({},e,{path:s}),null,!0),r._data(r._data()),r.refresh()})},t.prototype._refreshAfterRename=function(e,t){var n=this,r=U(e);r===n.options.currentFolder?n.refresh():(n._refreshTreeNode(r),e===n.options.currentFolder&&n._openFolder(t))},t.prototype._copy=function(){var e=this;if(!e._isActived()||!e.options.enableCopy)return;var t=e._getOperatingItems(),r=[];n.each(t,function(t,n){if(e._triggerItemCopying({path:n.path})===!1)return;r.push(n)}),e._copiedItems=r,e._commands.paste.disabled(!1),n.each(r,function(t,n){e._triggerItemCopied({path:n.path})})},t.prototype._paste=function(e,t){var r=this,i=r._getOperatingItem(),s=[];t=t||(i.isFolder?i.path:U(i.path)),e=e||r._copiedItems;if(!t)return;n.each(e,function(e,n){if(r._triggerItemPasting({sourcePath:n.path,targetFolder:t})===!1)return;s.push(n)});if(!s.length)return;r._pasteCall(s,t)},t.prototype._expandWithNewNodes=function(e,t){var n=this;if(!e)return;n._refreshTreeNode(e,function(){n._expandWithExistedNodes(n._getNodeByPath(e)),t&&t()})},t.prototype._filter=function(e){var t=this;if(!t._isActived()||e===t._filterExpression())return;if(t._triggerFiltering({path:t.options.currentFolder,filterExpression:e})===!1)return;t._updateItemsViewCall({filterExpression:e},!0,function(){t._triggerFiltered({path:t.options.currentFolder,filterExpression:e})})},t.prototype._sort=function(e,t){var n=this;if(!n._isActived())return;n._updateItemsViewCall({sortExpression:e,sortDirection:t})},t.prototype._page=function(e){var t=this;if(!t._isActived()||!t.options.allowPaging)return;t._updateItemsViewCall({pageIndex:e})},t.prototype._getDetailViewSelectedCells=function(){return this._detailView.wijgrid("selection").selectedCells()},t.prototype._onDetailViewSelectionChanged=function(){if(!this._isActived())return;var e=this,t=e._getDetailViewSelectedCells(),r=t.length(),i=[],s,o;for(s=0;s<r;s++)o=t.item(s),o.cellIndex()===0&&i.push({path:o.value(),isFolder:j(n(o.tableCell()).parent()),operatingArea:1});e._setSelection(i)},t.prototype._getExtendedKeyCode=function(){var e=this;return e._extendedKeyCode||(e._extendedKeyCode=n.extend({BACK:8,ESC:27,PAGEUP:33,PAGEDOWN:34,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},n.ui.keyCode)),e._extendedKeyCode},t.prototype._getInnerShortcuts=function(){var e=this;return e._innerShortcuts||(e._innerShortcuts={},n.each(e.options.shortcuts||{},function(t,n){e._innerShortcuts[t]=n.split("+")})),e._innerShortcuts},t.prototype._matchShortcuts=function(e){var t=this,r=t._getInnerShortcuts(),i,s,o,u,a=t._getExtendedKeyCode(),f=String.fromCharCode(e.keyCode);return n.each(r,function(t,n){s=(n.length&&n[0]).toLowerCase()+"Key",o=n.length&&(n.length===1?n[0]:n[1]).toUpperCase(),u=e[s];if(e.keyCode===a[o])return n.length===1||u?(i=t,!1):!0;if(f&&f===o)return n.length===1||u?(i=t,!1):!0}),i||!1},t.prototype._processShortcut=function(e){var t=this,r=t.options,i,s;if(r.disabled)return;i=t._matchShortcuts(e);if(!i)return;if(t._dialog.is(":visible")){if(i!=="popupWindowClose")return}else if(!t._isChildElement(n(e.target))&&i!=="focusFileExplorer")return;s=t._commands[i],s&&(s.execute(),e.stopPropagation(),e.preventDefault())},t.prototype._setFocus=function(e,t,n){var r=this,i=r._focusCss,s=t,o=n||r.element.parent();if(!e||!e.length)return;if(!s||!s.length)s=e;s&&s.focus(),o.find("."+i).removeClass(i),e.addClass(i)},t.prototype._focusFileExplorer=function(){var e=this;e._setFocus(e.element),e._restoreFocus=n.proxy(e._focusFileExplorer,e)},t.prototype._focusToolBar=function(){var e=this,t=e.element.find("."+u.toolbar),n=t.find("li").first();n.length&&(e._setFocus(t.parent()),n.addClass(e._focusCss))},t.prototype._focusTreeView=function(){var e=this,t=e._treeView,r;if(t&&t.length){if(t.find(":focus").length)return;r=t.find("span."+e._activeCss).first(),r&&r.length?r=r.find("a."+u.tvLink).first():r=t.find("li a."+u.tvLink).first(),e._setFocus(t.parent().parent(),r)}e._restoreFocus=n.proxy(e._focusTreeView,e)},t.prototype._focusGrid=function(){var e=this,t=e._detailView,r=e._thumbnailView,i=e._showingControls[d.detailView],s=e._showingControls[d.thumbnailView],o,a,f=e._itemsViewContainer.parent();if(f.hasClass(e._focusCss))return;i?t&&t.length&&(o=t.find("tbody tr td"),a=o.filter("."+u.stateHighlight).first(),e._setFocus(f),a.length===0?o.first().click():t.parent().focus()):s&&r&&r.length&&(e._setFocus(f),r.wijtilelist("setFocus")),e._restoreFocus=n.proxy(e._focusGrid,e)},t.prototype._focusAddressBar=function(){var e=this,t=e.element.find("."+u.addressBar);t&&t.length&&e._setFocus(t,t.find("."+u.address))},t.prototype._popupWindowClose=function(){var e=this;if(!e._dialog||!e._dialog.is(":visible"))return;e._hideDialog(),e._restoreFocus&&e._restoreFocus()},t.prototype._openContextMenu=function(){var e=this,t=e._getOperatingItem(),n=t&&e._getElementByPath(t.path,t.operatingArea);if(!n||!n.length)n=e.element;n.trigger("contextmenu")},t.prototype._focusPager=function(){var e=this,t=e.options,n=e._pager,r;if(!n||!n.length)return;r=n.find("a").first(),r&&r.length&&(e._setFocus(n),n.find("li."+u.stateActive).addClass(e._focusCss).off(i).on("keydown"+i,function(n){if(t.disabled)return;return e._processShortcut(n)}))},t.prototype._getElementByPath=function(e,t){var n=this,r;return t===0?(r=n._getNodeByPath(e),r&&r.element?r.element:null):n._getViewItemByPath(e,n._showingControls[d.detailView])},t.prototype._getViewItemByPath=function(e,t){var n=this;return t?n._getDetailViewItemByPath(e):n._getThumbnailViewItemByPath(e)},t.prototype._getDetailViewItemByPath=function(e){var t=this,r=t._detailView.find("tr"),i=r.first();return r.each(function(t,r){var s=n(r).find("td.wijgridtd"),o=!1;s.each(function(t,r){var i=n(r);if(i.text()===q(e))return o=!0,!1});if(o)return i=n(r),!1}),i},t.prototype._getThumbnailViewItemByPath=function(e){var t=this,r=t._thumbnailView.find("li"),i=r.first();return r.each(function(t,r){var s=n(r).find("span."+u.tileContent);if(s.text()===q(e))return i=n(r),!1}),i},t.prototype._onTreeViewRightKeyDown=function(){var e=this,t,n,r=e._treeView;if(r){n=r.find(":focus");if(!n||!n.length)n=r.find("."+e._focusCss);t=n.parents("li").first().data("wijmo-wijtreenode"),t&&!t.options.expanded&&(!t.$nodes||!t.$nodes.length)&&e._expandWithNewNodes(t.options.value)}},t.prototype._onTreeNodeClick=function(e,t){var n=this,r=n.options;if(!n._isActived())return;t._isClick=!1,t.options.selected||t._selectNode(!0),n._setSelection({path:t.options.value,isFolder:j(t.element),operatingArea:0},e.ctrlKey),r.mode===f["default"]&&n._openFolder(t.options.value)},t.prototype._isActived=function(){var e=this,t=e.options,n=e._getRootPaths();return!!(!t.disabled&&t.currentFolder&&n&&n.length)},t.prototype._setDragDrop=function(){var e=this;e._setTreeViewDragDrop(),e._setItemsViewDragDrop()},t.prototype._setTreeViewDragDrop=function(){var e=this,t=e._treeView.find("div.wijmo-wijtree-node");e._setDraggable(t),e._setDroppable(t)},t.prototype._setItemsViewDragDrop=function(){var e=this,t;e._showingControls[d.detailView]?t=e._detailView:e._showingControls[d.thumbnailView]&&(t=e._thumbnailView);if(t==null)return;e._setItemsViewDrag(t),e._setDroppable(t.find("."+u.folderItem))},t.prototype._setItemsViewDrag=function(e){var t=this,r=t.options,i=r.wijCSS,s=e.find("."+u.fileItem+",."+u.folderItem),o=s.hasClass("wijmo-wijgrid-row"),a,f;if(!s&&!s.length)return;t._setDraggable(s);if(!o)return;t._setDraggable(s.find("td[headers='Name']").find(".wijmo-wijgrid-innercell").children());if(r.disabled)return;s.each(function(e,t){a=n(t),f=o?a.find("td").hasClass(i.stateHighlight):a.hasClass(i.stateActive),a.draggable("option","disabled",!f)})},t.prototype._setDraggable=function(e){var t=this,r;e.each(function(e,i){r=n(i),r.data("ui-draggable")||r.draggable(t._createDragOptions())}),e.draggable("option","disabled",t.options.disabled)},t.prototype._setDroppable=function(e){var t=this,r;e.each(function(e,i){r=n(i),r.data("ui-droppable")||r.droppable({drop:function(e,n){t._onDrop(e,n,this)}})}),e.droppable("option","disabled",t.options.disabled)},t.prototype._createDragOptions=function(){var e=this;return{revert:"invalid",helper:function(t){var r=e._getItemFromElement(this),i=[],s=n("<ul>").addClass(e.options.wijCSS.helperReset),a=20,f,l,c=n(this);return r.operatingArea!==0?(e._isSelected(r)||(c.hasClass(u.tileItem)?e._thumbnailView.wijtilelist("selectTile",c,t.ctrlKey):(l=jQuery.Event("click"),l.ctrlKey=t.ctrlKey,l.shiftKey=t.shiftKey,l.target=t.target,f=e._detailView.data("wijmo-wijgrid"),f._onClick(l))),n.each(e._selection,function(e,t){i.push(t)})):i.push(r),n.each(i,function(e,t){var r=n("<span>").addClass("ui-icon").addClass(t.isFolder?u.folderCollapsedIcon:u.documentIcon),f=n("<span>").addClass(u.contentItem).addClass(u.dragContent).text(q(t.path)),l=n("<li>").append(r).append(f).height(a);s.append(l),s.data(o,i)}),c.draggable("option","cursorAt",{top:a*i.length/2,left:0}),s}}},t.prototype._onDrop=function(e,t,n){var r=this,i=t.helper.data(o),s=r._getItemFromElement(n).path,u,a=0,f;if(!i||!i.length)return;f=i.length,t.helper.data(o,null);for(;a<f;a++)if(i[a].path===s)return;u=P(i),e.ctrlKey?r._paste(u,s):r._hasRootPath(u)||r._move(u,s)},t.prototype._pasteCall=function(e,t){var r=this,i=n.map(e,function(e){return e.path});r._tryAjax(v.paste,{sourcePaths:i,path:t},null,function(e){if(!e.itemOperationResults||!e.itemOperationResults.length)return;n.each(e.itemOperationResults,function(e,n){if(!n)return;if(n.success){r._triggerItemPasted({path:n.path,targetFolder:t});return}r._processError(n.error)}),r._refreshAfterAdd(t)},function(){r._refreshAfterAdd(t)},function(){var i=n.map(e,function(e){return n.extend({},e,{path:M(t)+q(e.path)})});r._addItemsInData(i),r._refreshAfterAdd(t)})},t.prototype._move=function(e,t){var r=this,i=[];if(!e||!t)return;n.each(e,function(e,n){if(r._triggerItemMoving({sourcePath:n.path,targetFolder:t})===!1)return!1;i.push(n)});if(!i.length)return;var s=n.map(i,function(e){return e.path});r._tryAjax(v.move,{sourcePaths:s,path:t},null,function(e){if(!e.itemOperationResults||!e.itemOperationResults.length)return;var s=[];n.each(e.itemOperationResults,function(e,n){if(!n)return;if(n.success){r._triggerItemMoved({sourcePath:n.path,targetFolder:t}),s.push(O(i,n.path));return}r._processError(n.error)}),r._refreshAfterMove(s,t)},function(){r._refreshAfterMove(e,t)},function(){var i=n.map(e,function(e){return n.extend({},e,{path:M(t)+q(e.path)})});r._removeItemsInData(e,!0),r._addItemsInData(i),r._refreshAfterMove(e,t)})},t.prototype._refreshAfterAdd=function(e){this.refresh(e)},t.prototype._refreshAfterMove=function(e,t){this._refreshAfterDelete(e),this.refresh(t)},t.prototype._refreshAfterDelete=function(e){var t=this,r={},i=t.options.currentFolder,s,o=U(i);n.each(e,function(e,t){var n=t.path,u=U(t.path);r[n]=u,!s&&u===i&&(s=i),t.isFolder&&(!s&&(H(t.path,i)||t.path===i)?s=o:s&&H(t.path,s)&&(s=u))}),n.each(r,function(e,n){t._deleteTreeNode(e,n)}),s===i?t.refresh():s&&t._openFolder(s)},t.prototype._deleteTreeNode=function(e,t){var n=this,r=n._getNodeByPath(e),i=n._getNodeByPath(t),s;i&&r&&(s=!!(i.options.nodes.length-1),n._initNodeHasChildren(i,s),i.remove(r.element))},t.prototype._getCurrentFolderItem=function(){var e=this,t=e._data()||[],n=0,r=t.length,i=r>0,s=!1;for(;n<r;n++)if(t[n].isFolder){s=!0;break}return{path:e.options.currentFolder,isFolder:!0,hasChildren:i,hasSubFolders:s}},t.prototype._operatingItemsChanged=function(){this._updateCommandsForOperatingItems()},t.prototype._setOperatingItems=function(e){var t=this;n.isArray(e)||(e=[e]),t._operatingItems=e,t._operatingItemsChanged()},t.prototype._setContextItem=function(e){var t=this;t._contextItem=e,t._setOperatingItems(e||t._selection)},t.prototype._isSelected=function(e){var t=this._selection,r=!1;return t&&n.each(t,function(t,n){if(n.path===e.path&&n.operatingArea===e.operatingArea)return r=!0,!1}),r},t.prototype._sameWithSelection=function(e){var t=this._selection||[],r=!1,i;return e||(e=[]),n.isPlainObject(e)&&(e=[e]),e.length===t.length&&(r=!0,n.each(t,function(t,n){i=e[t];if(n.path!==i.path||n.operatingArea!==i.operatingArea)return r=!1,!1})),r},t.prototype._setSelection=function(e,t){var r=this;if(r._selectionUpdating)return;r._selection=r._selection||[],t||(r._selection.length=0),n.isArray(e)||(e=[e]);if(!e)return;n.each(e,function(e,t){t!=null&&r._selection.push(t)}),r._setOperatingItems(r._contextItem||r._selection),r._triggerItemSelected({path:r._selection&&r._selection.length?r._selection[0].path:null})},t.prototype._getOperatingItems=function(){var e=this,t=e._contextItem,r,i=e._selection;return t?(r=[t],t.operatingArea===1&&i&&n.each(i,function(e,n){n.operatingArea===1&&n.path!==t.path&&r.push(n)}),r):i&&i.length?i:[e._getCurrentFolderItem()]},t.prototype._getOperatingItem=function(){return this._getOperatingItems()[0]},t.prototype._getFocusedItemElement=function(){var e=this,t=e._getOperatingItem(),n;if(!t||!t.path)return null;e._currentFocusArea==="detailGrid"?n=e._detailView.find("td.wijgridtd"):e._currentFocusArea==="tileList"?n=e._thumbnailView.find("li.wijmo-wijtilelist-item"):e._currentFocusArea==="treeView"&&(n=e._treeView.find("li"));if(!n||!n.length)return;for(var r=0,i=n.length;r<i;r++){var s=n[r];if(s&&s.text()===t.path)return s}},t.prototype._getItemFromElement=function(e){var t=this,n=t.options,r=t._getFileItem(e),i,s,o=D(n.currentFolder);if(!r||r.length===0)return;return r.is(":wijmo-wijtreenode")?(i=r.wijtreenode("option","value"),s=0):(i=n.currentFolder+o+t._getItemText(r),s=1),{path:i,isFolder:j(r),operatingArea:s}},t.prototype._getFileItem=function(e){return n(e).closest("."+u.folderItem+",."+u.fileItem)},t.prototype._isTreeviewNode=function(e){return this._getFileItem(e).is(":wijmo-wijtreenode")},t.prototype._getItemText=function(e){var t=e.find("span."+u.contentItem).filter(function(e,t){return!n(t).hasClass(u.dragContent)});if(t.length>0)return t.text();t=e.find("span.wijmo-wijtilelist-content");if(t.length>0)return t.text()},t.prototype._findItemInData=function(e,t){if(!t)return-1;e=n.isPlainObject(e)?e.path:e;for(var r=0,i=t.length;r<i;r++)if(e===t[r].path)return r;return-1},t.prototype._addItemsInData=function(e,t,r){n.isArray(e)||(e=[e]);var i=this,s=t?n.isArray(t)?t:t.children:i._getFolderData(U(e[0].path));if(!s)return;n.each(e,function(e,t){s.push(t),r||i._data(i._data())})},t.prototype._removeItemsInData=function(e,t){var r=this;n.isArray(e)||(e=[e]),n.each(e,function(e,n){var i=r._getFolderData(U(n.path));if(i){var s=r._findItemInData(n,i);s>-1&&(i.splice(s,1),t||r._data(r._data()))}})},t.prototype._getCurrentFolderData=function(){var e=this;return e._enableAjax()?e._data():e._getFolderData(e.options.currentFolder)},t.prototype._getFolderData=function(e,t){var n=this,r;arguments.length==1&&(t=n._data()),t=t||[];if(!e)return t;for(var i=0,s=t.length;i<s;i++){var o=t[i],u=o.path;if(B(e,u)){r=t;break}if(!o.isFolder)continue;if(u===e){r=o.children;break}if(B(u,e)){r=n._getFolderData(e,o.children);break}}return r||[]},t.prototype._sortData=function(e,t,r){var i=this;t||(t=m.name),e=e||i._data(),e.sort(function(e,n){return i._sortComparer(e,n,t,r)}),n.each(e,function(e,t){t.children&&i._sortData(t.children)})},t.prototype._sortComparer=function(e,t,n,r){return this._sortComparerInner(e,t,n)*(r?-1:1)},t.prototype._sortComparerInner=function(e,t,n){if(e.isFolder!=t.isFolder)return e.isFolder?-1:1;var r=e[n],i=t[n];return r===i?0:r>i?1:-1},t.prototype._resolveData=function(e){var t=this;arguments.length===0&&(t._data()||t._data([]),e=t._data()),n.each(e,function(e,n){!n.hasChildren&&!n.children&&(n.children=[]);if(n.children||n.children.length>0){n.hasChildren=!0;var r=!1;for(var i=0,s=n.children.length;i<s;i++)if(n.isFolder){r=!0;break}n.hasSubFolders=r,t._resolveData(n.children)}else n.hasChildren=!1,n.hasSubFolders=!1})},t.prototype._setCurrentFolder=function(e){var t=this,n=t.options.currentFolder;t.options.currentFolder=e,t._currentFolderUpdated(),n!==e&&t._triggerFolderChanged({newFolder:e,oldFolder:n})},t.prototype._setOption=function(t,n){var r=this,i=r.options,s=!1,o=!1;if(t==="currentFolder")return;if(t==="mode")s=n!==i.mode;else if(t==="allowPaging"||t==="pageSize"&&i.allowPaging)o=n!==i[t];e.prototype._setOption.call(this,t,n),t==="disabled"?r._disabledUpdated():t==="viewMode"||t==="mode"||t==="visibleControls"||t==="allowPaging"||t==="treePanelWidth"?r._layoutOptionsUpdated(s):t==="enableOpenFile"?r._enableOpenFileUpdated():t==="enableCreateNewFolder"?r._enableCreateNewFolderUpdated():t==="enableCopy"?r._enableCopyUpdated():t==="allowMultipleSelection"?r._allowMultipleSelectionUpdated():t==="actionUri"?r._actionUriUpdated():t==="initPath"||t==="viewPaths"?r._rootPathsUpdated():t==="shortcuts"&&(r._innerShortcuts=null),o&&r.refresh()},t.prototype._actionUriUpdated=function(){this.options.hostUri=null},t.prototype._disabledUpdated=function(){var e=this,t=e.options.disabled;e._contextMenu.wijmenu("option","disabled",t),e._detailView.wijgrid("option","disabled",t),e._thumbnailView.wijtilelist("option","disabled",t),e._treeView.wijtree("option","disabled",t),e._pager.wijpager("option","disabled",t),e._splitter.wijsplitter("option","disabled",t),e._filterBox.prop("disabled",t),e._setDragDrop()},t.prototype._getRootPaths=function(){var e=this.options,t=e.initPath,n=e.viewPaths;return n&&n.length?n:t?[t]:[]},t.prototype._enableOpenFileUpdated=function(){var e=this;e._commands.open.disabled(!e.options.enableOpenFile)},t.prototype._enableCreateNewFolderUpdated=function(){var e=this;e._commands.newFolder.disabled(!e.options.enableCreateNewFolder)},t.prototype._allowMultipleSelectionUpdated=function(){var e=this;e._detailView.wijgrid("option","selectionMode",e.options.allowMultipleSelection?"multiRow":"singleRow"),e._thumbnailView.wijtilelist("option","allowMultipleSelection",e.options.allowMultipleSelection)},t.prototype._enableCopyUpdated=function(){var e=this;e.options.enableCopy||(e._copiedItems=null),e._commands.copy.disabled(!e.options.enableCopy),e._commands.paste.disabled(!e.options.enableCopy||e._copiedItems==null||e._copiedItems.length===0)},t.prototype._initDataOptions=function(){var e=this,t=e.options.data,r;delete e.options.data;if(t&&t.length){r=e._getRootPaths();if(!r||!r.length)e.options.viewPaths=n.map(t,function(e){return e.path})}e.options.currentFolder||(r=e._getRootPaths(),r&&r.length&&(e.options.currentFolder=r[0])),t&&e._data(t)},t.prototype._currentFolderUpdated=function(){var e=this,t=e.options.currentFolder;e._updateHistory(),e._addressBox.text(t).attr("title",t);if(e._showingControls[d.detailView]||e._showingControls[d.thumbnailView])e._updateItemsView(),e._triggerFolderLoaded({currentFolder:t});e._showCurrentFolderTreeNode()},t.prototype._updateItemsView=function(e){typeof e=="undefined"&&(e=!1);var t=this,n=t._showingControls[d.detailView],r=t._showingControls[d.thumbnailView],i=t._getCurrentFolderData(),s=t._filterExpression()||S;t._itemsViewContainer.height(Math.max(0,t._pager.parent().height()-(t.options.allowPaging?t._pager.outerHeight():0)-parseInt(t._itemsViewContainer.css("borderTopWidth"))-parseInt(t._itemsViewContainer.css("borderBottomWidth")))),n?(t._updatingDetailViewData=!0,t._detailView.wijgrid("option","data",i).wijgrid("ensureControl",!0),t._updatingDetailViewData=!1,t._adjustDetailViewWidth()):r&&t._thumbnailView.wijtilelist("option","data",i),!i||!i.length?t._emptyFolderTip.show():t._emptyFolderTip.hide(),t.options.allowPaging&&t._pager.wijpager("option",{pageCount:t._pageCount(),pageIndex:t._pageIndex()}),!e&&s!==t._filterBox.val()&&t._filterBox.val(s),t._setItemsViewDragDrop()},t.prototype._updateHistory=function(){var e=this;e._histories||(e._histories=[],e._currentHistoryIndex=-1);var t=e.options.currentFolder,n=e._histories,r=n.length;if(e._updatingHistoryStep){var i=e._currentHistoryIndex+e._updatingHistoryStep;e._updatingHistoryStep=0;if(i>=r||i<0)return;e._currentHistoryIndex=i}else{if(r&&t===n[r-1])return;e._currentHistoryIndex++,n.splice(e._currentHistoryIndex,r-e._currentHistoryIndex,t)}e._commands.back.disabled(!e._canBack()),e._commands.forward.disabled(!e._canForward())},t.prototype._canBack=function(){var e=this;return e._histories&&e._histories.length>1&&e._currentHistoryIndex>0},t.prototype._canForward=function(){var e=this;return e._histories&&e._histories.length>1&&e._currentHistoryIndex<e._histories.length-1},t.prototype._showCurrentFolderTreeNode=function(){var e=this;e._expand(e._getParentNodeByPath(e.options.currentFolder),function(){return e._selectCurrentFolderTreeNode()})},t.prototype._expandWithExistedNodes=function(e){while(e)e.options.expanded||e.expand(),e=this._getParentNodeByPath(e.options.value)},t.prototype._updateTreeViewData=function(e,t){var n=this,r=n._getNodeByPath(e)||n._treeView.data("wijmoWijtree");t=t||[],n._setTreeViewNodes(n._getFolderData(e,t),r),n._setTreeViewDragDrop()},t.prototype._getParentNodeByPath=function(e){return e?this._getNodeByPath(U(e)):null},t.prototype._getNodeByPath=function(e,t){var n=this;t||(t=n._treeView.wijtree("getNodes"));for(var r=0;r<t.length;r++){var i=t[r];if(i.options.value==e)return i;var s=i.getNodes();if(s.length>0){var o=n._getNodeByPath(e,s);if(null==o)continue;return o}}return null},t.prototype._updateCommandsForOperatingItems=function(){var e=this,t=e._getOperatingItems(),n=e._commands;n.rename.disabled(e._isRootPath(t[0].path)),n["delete"].disabled(e._hasRootPath(t))},t.prototype._layoutOptionsUpdated=function(e){var t=this,n=t.options,r=n.wijCSS,i=t.element.find("."+u.addressBar),s=t.element.find("."+u.splitterV),o=t.element.find("."+u.splitterVPanel1),l=t.element.find("."+u.splitterVPanel2),c=t.element.find("."+u.splitterVPanel1Content),h=t.element.find("."+u.splitterVPanel2Content),p=t._isVisibleControl(d.toolbar),v=t._isVisibleControl(d.addressBox),m=t._isVisibleControl(d.detailView)&&n.mode===f["default"]&&n.viewMode===a.detail,g=t._isVisibleControl(d.thumbnailView)&&n.mode===f["default"]&&n.viewMode===a.thumbnail,y=t._isVisibleControl(d.detailView)&&t._isVisibleControl(d.thumbnailView)&&n.mode===f["default"],b=t._isVisibleControl(d.treeView),w=t._isVisibleControl(d.contextMenu),E=t._isVisibleControl(d.filterBox)&&(m||g),S=t._toolbar.children("."+u.toolbarSetDetailViewMode),x=t._toolbar.children("."+u.toolbarSetThumbnailViewMode),T=t._showingControls,N=T[d.treeView]&&(T[d.detailView]||T[d.thumbnailView]),C=b&&(m||g),k;t._showingControls={},t._showingControls[d.contextMenu]=w,t._showingControls[d.toolbar]=p,p?t._toolbar.show():t._toolbar.hide(),t._showingControls[d.addressBox]=v,v?(t._addressBox.show(),t._addressBox.parent().show(),E?t._addressBox.parent().removeClass(u.addressBarFullWidth):t._addressBox.parent().addClass(u.addressBarFullWidth)):(t._addressBox.hide(),t._addressBox.parent().hide()),t._showingControls[d.filterBox]=E,E?(t._filterBox.show(),t._filterBox.parent().show(),v?t._filterBox.parent().removeClass(u.addressBarFullWidth):t._filterBox.parent().addClass(u.addressBarFullWidth)):(t._filterBox.hide(),t._filterBox.parent().hide()),v||E?i.show():i.hide(),k=t.element.height()-(t._toolbar.is(":visible")?t._toolbar.height():0)-(i.is(":visible")?i.height():0),c.height(k),h.height(k),N!==C&&(c.detach(),h.detach(),C?(c.appendTo(o),h.appendTo(l)):(c.appendTo(t.element),h.appendTo(t.element))),C?(o.height(k),l.height(k),s.height(k).wijsplitter("option","splitterDistance",n.treePanelWidth).show()):s.hide(),t._showingControls[d.treeView]=b,b?(t._treeView.show(),c.show()):(t._treeView.hide(),c.hide()),t._showingControls[d.detailView]=m,m?(t._detailView.show(),t._detailView.parent().show()):(t._detailView.hide(),t._detailView.parent().hide()),t._showingControls[d.thumbnailView]=g,g?t._thumbnailView.show():t._thumbnailView.hide(),m||g?h.show():h.hide(),y?(S.show(),x.show()):(S.hide(),x.hide()),n.viewMode===a.thumbnail?(S.removeClass(r.stateActive),x.addClass(r.stateActive)):(S.toggleClass(r.stateActive),x.removeClass(r.stateActive)),t.options.allowPaging?t._pager.show():t._pager.hide(),e?t._refreshRoot():(m||g)&&t._updateItemsView()},t.prototype._rootPathsUpdated=function(){var e=this;e._histories=[],e._currentHistoryIndex=-1,e._refreshRoot()},t.prototype._refreshRoot=function(){var e=this;e._data(null),e.options.currentFolder=null,e._initDataOptions(),e._updateTreeViewData(null,[]),e._createRootNodes(),e._loadCurrentFolder()},t.prototype._triggerFiltering=function(e){return this._trigger("filtering",null,e)},t.prototype._triggerFiltered=function(e){this._trigger("filtered",null,e)},t.prototype._triggerItemDeleting=function(e){return this._trigger("itemDeleting",null,e)},t.prototype._triggerItemDeleted=function(e){this._trigger("itemDeleted",null,e)},t.prototype._triggerItemMoving=function(e){return this._trigger("itemMoving",null,e)},t.prototype._triggerItemMoved=function(e){this._trigger("itemMoved",null,e)},t.prototype._triggerItemPasting=function(e){return this._trigger("itemPasting",null,e)},t.prototype._triggerItemPasted=function(e){this._trigger("itemPasted",null,e)},t.prototype._triggerItemCopying=function(e){return this._trigger("itemCopying",null,e)},t.prototype._triggerItemCopied=function(e){this._trigger("itemCopied",null,e)},t.prototype._triggerItemRenaming=function(e){return this._trigger("itemRenaming",null,e)},t.prototype._triggerItemRenamed=function(e){this._trigger("itemRenamed",null,e)},t.prototype._triggerNewFolderCreating=function(e){return this._trigger("newFolderCreating",null,e)},t.prototype._triggerNewFolderCreated=function(e){this._trigger("newFolderCreated",null,e)},t.prototype._triggerErrorOccurred=function(e){return this._trigger("errorOccurred",null,e)},t.prototype._triggerItemSelected=function(e){this._trigger("itemSelected",null,e)},t.prototype._triggerFileOpening=function(e){return this._trigger("fileOpening",null,e)},t.prototype._triggerFileOpened=function(e){this._trigger("fileOpened",null,e)},t.prototype._triggerFolderChanged=function(e){this._trigger("folderChanged",null,e)},t.prototype._triggerFolderLoaded=function(e){this._trigger("folderLoaded",null,e)},t.prototype._createFakeResponse=function(){return{success:!0,hostUri:"",items:this._data()}},t.prototype._tryAjax=function(e,t,n,r,i,s){var o=this;if(!o._enableAjax()){s?s():r(o._createFakeResponse());return}o._ajaxActions||(o._ajaxActions=[]);var u=function(){o._ajaxActionEnded(),o._ajaxActions.shift(),o._nextAjaxAction(),o._ajaxActions&&o._ajaxActions.length===0&&o._restoreFocus&&o._restoreFocus()},a=function(e){if(!i||!i(e)){var t=typeof e=="string"?e:e.error;t=t||"Unknown error.",o._processError(t)}},f=function(e){e&&(e.success&&r?r(e):e.success||a(e)),u()},l=function(e){a(e),u()};t=t||{},t.commandName=e,o._ajaxActions.push(o._createAjaxAction(t,n,f,l)),o._ajaxActions.length===1&&o._nextAjaxAction()},t.prototype._processError=function(e){if(this._triggerErrorOccurred({error:e})===!1)return;alert(e)},t.prototype._nextAjaxAction=function(){var e=this;e._ajaxActions.length>0&&(e._ajaxActions[0](),e._ajaxActionStarted())},t.prototype._ajaxActionStarted=function(){var e=this;e._showLoadingLayer()},t.prototype._ajaxActionEnded=function(){var e=this;e._hideLoadingLayer()},t.prototype._isLoading=function(){var e=this;return e._showLoadingLayerTimer!=null||e._isLoadingLayerShowing()},t.prototype._isLoadingLayerShowing=function(){var e=this;return e._loadingLayer&&e._loadingLayer.length&&e._loadingLayer.is(":visible")},t.prototype._hideLoadingLayer=function(){var e=this;e._showLoadingLayerTimer!=null&&(clearTimeout(e._showLoadingLayerTimer),e._showLoadingLayerTimer=null),e._isLoadingLayerShowing()&&e._loadingLayer.hide()},t.prototype._showLoadingLayer=function(){var e=this,t=this.options.wijCSS;if(e._showLoadingLayerTimer!=null||e._loadingLayer&&e._loadingLayer.length&&e._loadingLayer.is(":visible"))return;e._showLoadingLayerTimer=setTimeout(function(){if(!e._loadingLayer||!e._loadingLayer.length)e._loadingLayer=n("<div>").append('<div class="'+u.loadingOverlay+" "+t.overlay+'"></div>'+'<span class="'+u.loadingText+" "+t.content+" "+t.cornerAll+'">'+'<span class="'+t.icon+" "+t.iconClock+'"></span>'+e.localizeString("loadingText","Loading...")+"</span>"),e._loadingLayer.hide(),e._loadingLayer.appendTo(e.element);e._loadingLayer.show(),e._loadingLayer.find("> ."+u.loadingText).position({my:"center",at:"center center",of:e.element,collision:"none"}),e._showLoadingLayerTimer=null},E)},t.prototype._createAjaxAction=function(e,t,r,i){var s=this;return function(){n.ajax({url:s.options.actionUri,data:e,context:t,success:r,error:i,dataType:"json",cache:!1})}},t.prototype._enableAjax=function(){return this.options.actionUri!==undefined},t.prototype._isRootPath=function(e){return n.inArray(e,this._getRootPaths())>-1},t.prototype._hasRootPath=function(e){var t=this;for(var r=0,i=e.length;r<i;r++){var s=e[r],o=n.isPlainObject(s)?s.path:s;if(t._isRootPath(o))return!0}return!1},t.prototype._getParentPath=function(e){return this._isRootPath(e)?null:U(e)},t.prototype.localizeString=function(e,t){var n=this._getLocalization();return n&&n[e]?n[e]:t},t.prototype._getLocalization=function(){return this.options.localization},t}(e.wijmoWidget);t.wijfileexplorer=X,function(e){e[e.TreeView=0]="TreeView",e[e.ItemsView=1]="ItemsView"}(t.OperatingArea||(t.OperatingArea={}));var V=t.OperatingArea,$=function(){function e(e,t,n){this.name=e,this.action=t,this.text=n,this._bindElements=[]}return e.prototype.disabled=function(e){var t=this;if(e===undefined)return t._disabled;t._disabled!==e&&(t._disabled=e,t._onDisabledChanged())},e.prototype._onDisabledChanged=function(){var e=this,t=n.wijmo.wijCSS.stateDisabled;n.each(e._bindElements,function(n,r){e.disabled()?r.addClass(t):r.removeClass(t)})},e.prototype.addBindElement=function(e){this._bindElements.push(e)},e.prototype.removeBindElement=function(e){var t=this._bindElements,r=n.inArray(e,t);r>-1&&t.splice(r,1)},e.prototype.execute=function(e){var t=this;t._disabled||t.action(e)},e}(),J=function(){function e(){this.mode=f["default"],this.searchPatterns=k.slice(),this.viewMode=a.detail,this.allowFileExtensionRename=!1,this.allowMultipleSelection=!1,this.allowPaging=!1,this.pageSize=10,this.shortcuts=n.extend({},L),this.enableOpenFile=!0,this.enableCreateNewFolder=!0,this.enableCopy=!0,this.enableFilteringOnEnterPressed=!1,this.visibleControls=[d.addressBox,d.contextMenu,d.detailView,d.filterBox,d.thumbnailView,d.toolbar,d.treeView].join(","),this.treePanelWidth=200,this.disabled=!1,this.itemSelected=null,this.fileOpened=null,this.fileOpening=null,this.itemCopying=null,this.itemCopied=null,this.itemRenaming=null,this.itemRenamed=null,this.itemDeleting=null,this.itemDeleted=null,this.errorOccurred=null,this.itemPasting=null,this.itemPasted=null,this.itemMoving=null,this.itemMoved=null,this.newFolderCreating=null,this.newFolderCreated=null,this.folderChanged=null,this.folderLoaded=null,this.filtering=null,this.filtered=null}return e}();t.wijfileexplorer_options=J,X.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,new J),X.prototype.widgetEventPrefix="wijfileexplorer",n.wijmo.registerWidget("wijfileexplorer",X.prototype)})(e.fileexplorer||(e.fileexplorer={}));var t=e.fileexplorer})(wijmo||(wijmo={}));